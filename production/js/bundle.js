!function(){function e(e){var t=Date.now()/1e3,n=new Date(e).getTime()/1e3;return Math.floor((t-n)/86400)}function t(){if(void 0!==GLOBAL_CONFIG.Snackbar)btf.snackbarShow(GLOBAL_CONFIG.copy.success);else{const e=ctx.previousElementSibling;e.innerText=GLOBAL_CONFIG.copy.success,e.style.opacity=1,setTimeout((()=>{e.style.opacity=0}),700)}}function n(e,t,n){const o=[e,t,n].map((e=>(e/=255)<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4)));return.2126*o[0]+.7152*o[1]+.0722*o[2]}function o(e,t){return(e+.05)/(t+.05)}window.toRandomPost=async function(){const e=await async function(e){try{const t=await fetch(e),n=await t.text(),o=(new DOMParser).parseFromString(n,"application/xml").getElementsByTagName("item"),i=Array.from(o).map((e=>e.getElementsByTagName("link")[0].textContent));if(i.length>0){const e=i[Math.floor(Math.random()*i.length)];return console.log("randomLink:"),console.log(e),e}console.error("No articles found.")}catch(e){console.error("Error fetching RSS feed:",e)}}("/rss.xml");pjax.loadUrl(e)},window.onload=function(){for(var e=document.getElementsByClassName("copybtn"),n=0;n<e.length;n++)document.getElementsByClassName("copybtn")[n].addEventListener("click",(function(){t()}));wjx.initThemeColor()},window.travelling=function(e,t){const n=JSON.parse(saveToLocal.get("links-data"));var o=new Map;n.forEach((e=>{for(let t of e.links)o.set(t.display_name,t)}));var i=[...o.values()],a="",r="";if(i.length>0){var s=getArrayItems(i,1);a=s[0].display_name,r=s[0].url}var c="点击前往按钮进入随机一个友链，不保证跳转网站的安全性和可用性。本次随机到的是本站友链：「"+a+"」";const l=document.createElement("style");document.head.appendChild(l);const d=l.sheet;d.insertRule(":root{--wjx-snackbar-time: 8000ms!important}",d.cssRules.length),Snackbar.show({text:c,duration:8e3,pos:"top-center",actionText:"前往",onActionClick:function(e){$(e).css("opacity",0),window.open(r,"_blank","noopener,noreferrer")}})},window.totraveling=function(e,t){btf.snackbarShow("即将跳转到「开往」项目的成员博客，不保证跳转网站的安全性和可用性",(function(e){e.style.opacity=0,travellingsTimer&&clearTimeout(travellingsTimer)}),5e3,"取消"),travellingsTimer=setTimeout((function(){window.open("https://www.travellings.cn/go.html","_blank")}),"5000")},window.addFriendLink=function(e,t){var n=document.getElementsByClassName(GLOBAL_CONFIG.source.comments.textarea)[0];let o=document.createEvent("HTMLEvents");o.initEvent("input",!0,!0),n.value="昵称（请勿包含博客等字样）：\n网站地址（要求博客地址，请勿提交个人主页）：\n头像图片url（请提供尽可能清晰的图片，我会上传到我自己的图床）：\n描述：\n",n.dispatchEvent(o),wjx.scrollTo("#post-comment"),n.focus(),n.setSelectionRange(-1,-1)},window.getArrayItems=function(e,t){var n=new Array;for(var o in e)n.push(e[o]);for(var i=new Array,a=0;a<t&&n.length>0;a++){var r=Math.floor(Math.random()*n.length);i[a]=n[r],n.splice(r,1)}return i};var i=()=>{const e=document.body;e.classList.add("read-mode");const t=document.createElement("button");t.type="button",t.className="icon-sign-out-alt exit-readmode",e.appendChild(t),t.addEventListener("click",(function n(){e.classList.remove("read-mode"),t.remove(),t.removeEventListener("click",n)}))},a=()=>{document.getElementById("rightside-config-hide").classList.toggle("show")},r=()=>{btf.scrollToDest(0,500)},s=()=>{const e=document.documentElement.classList;e.contains("hide-aside")?saveToLocal.set("aside-status","show",2):saveToLocal.set("aside-status","hide",2),e.toggle("hide-aside")},c=e=>{const t=document.getElementById("card-toc");t.style.transformOrigin=`right ${e.getBoundingClientRect().top+17}px`,t.style.transition="transform 0.3s ease-in-out",t.classList.toggle("open"),t.addEventListener("transitionend",(()=>{t.style.transition="",t.style.transformOrigin=""}),{once:!0})},l=!1,d=()=>{const e="fancybox"===GLOBAL_CONFIG.lightbox?document.querySelectorAll("#article-container img:not(.no-lightbox), #article-container picture"):[],t=e.length>0,n=document.querySelectorAll("#article-container .gallery"),o=n.length>0;(o||t)&&btf.isJqueryLoad((()=>{var i;o&&(i=n,l?btf.initJustifiedGallerys(i):($("head").append(`<link rel="stylesheet" type="text/css" href="${GLOBAL_CONFIG.source.justifiedGallery.css}">`),$.getScript(`${GLOBAL_CONFIG.source.justifiedGallery.js}`,(function(){btf.initJustifiedGallerys(i)})),l=!0)),t&&function(e){const t=e=>{e.each((function(e,t){const n=$(t),o=n.attr("src"),i=n.attr("alt")||"";n.wrap(`<a href="${o}" data-fancybox="images" data-caption="${i}" class="fancybox" data-srcset="${o}"></a>`)})),$().fancybox({selector:"[data-fancybox]",loop:!0,transitionEffect:"slide",protect:!0,buttons:["slideShow","fullScreen","thumbs","close"],hash:!1})};void 0===$.fancybox?$.getScript(`${GLOBAL_CONFIG.source.fancybox.js}`,(function(){t($(e))})):t($(e))}(e)}))};window.loadFiles=function(e,t){let n=0;e.forEach((o=>{let i;"js"===o.type?(i=document.createElement("script"),i.src=o.path):"css"===o.type&&(i=document.createElement("link"),i.rel="stylesheet",i.href=o.path),i.onload=()=>{n++,n===e.length&&t()},i.onerror=()=>{n++},"js"===o.type?document.body.appendChild(i):"css"===o.type&&document.head.appendChild(i)}))};var u,m,f=function(){document.querySelectorAll("#article-container .tab > button").forEach((function(e){e.addEventListener("click",(function(e){const t=this,n=t.parentNode;if(!n.classList.contains("active")){const e=n.parentNode.nextElementSibling,o=btf.siblings(n,".active")[0];o&&o.classList.remove("active"),n.classList.add("active");const i=t.getAttribute("data-href").replace("#","");[...e.children].forEach((e=>{e.id===i?e.classList.add("active"):e.classList.remove("active")}));const a=e.querySelectorAll(`#${i} .gallery`);a.length>0&&btf.initJustifiedGallerys(a)}}))}))},h=()=>{document.querySelectorAll("#article-container .tabs .tab-to-top").forEach((function(e){e.addEventListener("click",(function(){btf.scrollToDest(btf.getEleTop(btf.getParents(this,".tabs")),300)}))}))};document.getElementById("post-comment")&&new MutationObserver((e=>{for(let t of e)if("childList"===t.type)for(let e of t.addedNodes)if(e.classList&&e.classList.contains("OwO-body")){let t=e,n="",o=!0,i=document.createElement("div");i.id="owo-big",document.querySelector("body").appendChild(i),t.addEventListener("contextmenu",(e=>e.preventDefault())),t.addEventListener("mouseover",(e=>{"LI"===e.target.tagName&&o&&(o=!1,n=setTimeout((()=>{let t=3*e.target.clientWidth,n=e.x-e.offsetX-(t-e.target.clientWidth)/2,o=e.y-e.offsetY;i.style.height=3*e.target.clientHeight+"px",i.style.width=t+"px",i.style.left=n+"px",i.style.top=o+"px",i.style.display="flex",i.innerHTML=`<img src="${e.target.querySelector("img").src}" loading="lazy">`}),300))})),t.addEventListener("mouseout",(e=>{i.style.display="none",o=!0,clearTimeout(n)}))}})).observe(document.getElementById("post-comment"),{childList:!0,subtree:!0}),$("input").focus((function(){wjx_intype=!0})),$("textarea").focus((function(){wjx_intype=!0})),$("input").focusout((function(){wjx_intype=!1})),$("textarea").focusout((function(){wjx_intype=!1})),window.getTimeState=function(){if("default"==GLOBAL_CONFIG.profileStyle){var e=(new Date).getHours(),t="";return e>=0&&e<=5?t="晚安":e>5&&e<=10?t="早上好":e>10&&e<=14?t="中午好":e>14&&e<=18?t="下午好":e>18&&e<=24&&(t="晚上好"),t}if("one"==GLOBAL_CONFIG.profileStyle){var n=(new Date).getHours(),o="";return n>=0&&n<=5?o="睡个好觉，保证精力充沛":n>5&&n<=10?o="一日之计在于晨":n>10&&n<=14?o="吃饱了才有力气干活":n>14&&n<=18?o="集中精力，攻克难关":n>18&&n<=24&&(o="不要太劳累了，早睡更健康"),o}},switchDarkMode=()=>{"dark"===document.documentElement.getAttribute("data-theme")?(activateLightMode(),saveToLocal.set("theme","light",2),void 0!==GLOBAL_CONFIG.Snackbar&&btf.snackbarShow(GLOBAL_CONFIG.Snackbar.night_to_day,!1,2e3),$(".menu-darkmode-text").text("深色模式")):(activateDarkMode(),saveToLocal.set("theme","dark",2),void 0!==GLOBAL_CONFIG.Snackbar&&btf.snackbarShow(GLOBAL_CONFIG.Snackbar.day_to_night,!1,2e3),$(".menu-darkmode-text").text("浅色模式")),handleCases(),wjx.darkModeStatus()},handleCases=()=>{"function"==typeof utterancesTheme&&utterancesTheme(),"object"==typeof FB&&window.loadFBComment(),window.DISQUS&&document.getElementById("disqus_thread").children.length&&setTimeout((()=>window.disqusReset()),200)},navFn={switchDarkMode:switchDarkMode},$(window).on("keydown",(function(e){if(27==e.keyCode&&(wjx.hideLoading(),wjx.hideConsole(),rm.hideRightMenu()),wjx_keyboard&&e.shiftKey&&!wjx_intype){if(75==e.keyCode)return wjx.keyboardToggle(),!1;if(65==e.keyCode)return wjx.showConsole(),!1;if(77==e.keyCode)return wjx.musicToggle(),!1;if(82==e.keyCode)return toRandomPost(),!1;if(72==e.keyCode)return pjax.loadUrl("/"),!1;if(68==e.keyCode)return rm.switchDarkMode(),!1;if(76==e.keyCode)return pjax.loadUrl("/link/"),!1;if(80==e.keyCode)return pjax.loadUrl("/about/"),!1;if(84==e.keyCode)return pjax.loadUrl("/tlink/"),!1}})),window.addEventListener("resize",(function(){document.querySelector("#waterfall")&&wjx.reflashEssayWaterFall()})),document.querySelector("#console")&&document.querySelector("#console").addEventListener("wheel",(e=>{e.preventDefault()})),window.onkeydown=function(e){123===e.keyCode&&btf.snackbarShow("开发者模式已打开，请遵循GPL协议",!1,3e3)},$(document).unbind("keydown").bind("keydown",(function(e){if(GLOBAL_CONFIG.rightMenuEnable&&(e.ctrlKey||e.metaKey)&&67==e.keyCode&&""!=selectTextNow)return btf.snackbarShow("复制成功，复制和转载请标注本文地址"),rm.rightmenuCopyText(selectTextNow),!1})),u=document.getElementById("post-comment"),m=document.getElementById("pagination"),u&&new IntersectionObserver((function(e){e.forEach((function(e){e.isIntersecting?(m&&m.classList.add("show-window"),document.querySelector(".comment-barrage").style.bottom="-200px"):(m&&m.classList.remove("show-window"),document.querySelector(".comment-barrage").style.bottom="0px")}))})).observe(u),GLOBAL_CONFIG.source.post.dynamicBackground&&function(){var e=document.getElementById("post-cover")?.src;if(void 0!==e){(new FastAverageColor).getColorAsync(e,{ignoredColor:[255,255,255,255]}).then((e=>{var t,n,o,i,a,r=e.hex;"light"==(n=function(e){var t=/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/,n=e.toLowerCase();if(n&&t.test(n)){if(4===n.length){for(var o="#",i=1;i<4;i+=1)o+=n.slice(i,i+1).concat(n.slice(i,i+1));n=o}var a=[];for(i=1;i<7;i+=2)a.push(parseInt("0x"+n.slice(i,i+2)));return"rgb("+a.join(",")+")"}return n}(r).match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/),o=n[1],i=n[2],a=n[3],t=299*o+587*i+114*a,(t/=255e3)>=.5?"light":"dark")&&(r=function(e,t){var n=!1;"#"==e[0]&&(e=e.slice(1),n=!0);var o=parseInt(e,16),i=(o>>16)+t;i>255?i=255:i<0&&(i=0);var a=(o>>8&255)+t;a>255?a=255:a<0&&(a=0);var r=(255&o)+t;r>255?r=255:r<0&&(r=0);return(n?"#":"")+String("000000"+(r|a<<8|i<<16).toString(16)).slice(-6)}(function(e){var t=/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/,n=e;if(/^(rgb|RGB)/.test(n)){for(var o=n.replace(/(?:\(|\)|rgb|RGB)*/g,"").split(","),i="#",a=0;a<o.length;a++){var r=Number(o[a]).toString(16);"0"===r&&(r+=r),i+=r}return 7!==i.length&&(i=n),i}if(!t.test(n))return n;var s=n.replace(/#/,"").split("");if(6===s.length)return n;if(3===s.length){var c="#";for(a=0;a<s.length;a+=1)c+=s[a]+s[a];return c}}(r),-40));const s=document.createElement("style");document.head.appendChild(s);const c=s.sheet;c.insertRule(`:root{--wjx-main: ${r}!important}`,c.cssRules.length),c.insertRule(`:root{--wjx-main-op: ${r}23!important}`,c.cssRules.length),c.insertRule(`:root{--wjx-main-op-deep: ${r}dd!important}`,c.cssRules.length),c.insertRule(`:root{--wjx-main-none: ${r}00!important}`,c.cssRules.length),wjx.initThemeColor(),document.getElementById("coverdiv").classList.add("loaded")})).catch((e=>{console.log(e)}))}else{const e=document.createElement("style");document.head.appendChild(e);const t=e.sheet;t.insertRule(":root{--wjx-main: var(--wjx-theme)!important}",t.cssRules.length),t.insertRule(":root{--wjx-main-op: var(--wjx-theme-op)!important}",t.cssRules.length),t.insertRule(":root{--wjx-main-op-deep:var(--wjx-theme-op-deep)!important}",t.cssRules.length),t.insertRule(":root{--wjx-main-none: var(--wjx-theme-none)!important}",t.cssRules.length),wjx.initThemeColor()}}(),wjx.addPowerLinksInPostRightSide(),document.addEventListener("touchstart",(e=>{document.querySelector(".reward-main")&&(document.querySelector(".reward-main").style.display="none",document.getElementById("quit-box").style.display="none")}),!1),"undefined"!=typeof isTagsRandomColor&&isTagsRandomColor&&function(){let e,t=n(255,255,255);for(const a of document.getElementsByClassName("tag-item")){do{e={r:Math.floor(256*Math.random()),g:Math.floor(256*Math.random()),b:Math.floor(256*Math.random())};var i=o(t,n(e.r,e.g,e.b))}while(i<4.5);const r=`#${((1<<24)+(e.r<<16)+(e.g<<8)+e.b).toString(16).slice(1)}`;a.style.color=r}}(),GLOBAL_CONFIG.isFriendLinksInFooter&&wjx.addFriendLinksInFooter(),GLOBAL_CONFIG.isMusic&&wjx.changeMusicBg(!1),window.initBlogLazy=runOnce("initBlogLazy")((()=>{GLOBAL_CONFIG.isPost?(!function(){const e=document.querySelector(".post-content");if(null==e)return;const t=e.querySelectorAll("h1,h2,h3,h4,h5,h6");if(0!==t.length&&t){tocbot.init({tocSelector:".toc-content",contentSelector:".post-content",headingSelector:"h1,h2,h3,h4,h5,h6",listItemClass:"toc-item",activeLinkClass:"active",activeListItemClass:"active",headingsOffset:-400,scrollSmooth:!0,scrollSmoothOffset:-70,tocScrollOffset:50});const e=document.getElementById("card-toc");e.getElementsByClassName("toc-content")[0].addEventListener("click",(t=>{window.innerWidth<900&&e.classList.remove("open")}))}else{const e=document.getElementById("card-toc");e?.remove(),document.getElementById("mobile-toc-button")&&$("#mobile-toc-button").attr("style","display: none")}}(),runPostAbstract(),function(){if(GLOBAL_CONFIG.passageTip.enable){const t=document.getElementById("passage-tip");if(t&&t.getAttribute("data-tip-enable")){const n=t.getAttribute("data-update-date");e(n)>GLOBAL_CONFIG.passageTip.day&&(t.innerHTML=`<p>本文最后更新于 ${n}，文章内容可能已经过时。</p>`,t.style.display="block",setTimeout((function(){t.classList.add("fade-in")}),10))}}}(),wjx.qrcodeCreate()):(function(){const e=document.querySelectorAll("#aside-cat-list .card-category-list-item.parent i");e.length&&e.forEach((function(e){e.addEventListener("click",(function(e){e.preventDefault(),this.classList.toggle("expand");const t=this.parentNode.nextElementSibling;btf.isHidden(t)?t.style.display="block":t.style.display="none"}))}))}(),function(){const t=document.getElementsByClassName("post-meta-date-publish");for(var n=0;n<t.length;n++){var o=t[n].getAttribute("datetime"),i=e(o),a="";a=i>30?o:i>0?i+"天前":"今天",t[n].innerHTML=a,t[n].title=o+"创建"}}()),document.getElementById("rightside").addEventListener("click",(function(e){switch(e.target.id||e.target.parentNode.id){case"go-up":r();break;case"rightside-config":a();break;case"mobile-toc-button":c(this);break;case"readmode":i();break;case"darkmode":navFn.switchDarkMode();break;case"hide-aside-btn":s()}})),function(){const e=document.querySelectorAll("#article-container :not(.highlight) > table, #article-container > table");e.length&&e.forEach((e=>{btf.wrap(e,"div","","table-wrap")}))}(),function(){const e=document.querySelectorAll("#article-container .hide-button");e.length&&e.forEach((function(e){e.addEventListener("click",(function(e){const t=this,n=t.nextElementSibling;t.classList.toggle("open"),t.classList.contains("open")&&n.querySelectorAll(".gallery").length>0&&btf.initJustifiedGallerys(n.querySelectorAll(".gallery"))}))}))}(),f(),h(),d(),document.querySelectorAll("#sidebar-menus .expand").forEach((function(e){e.addEventListener("click",(function(){this.classList.toggle("hide");const e=this.parentNode.nextElementSibling;btf.isHidden(e)?e.style.display="block":e.style.display="none"}))})),window.addEventListener("touchmove",(function(e){document.querySelectorAll("#nav .menus_item_child").forEach((e=>{btf.isHidden(e)||(e.style.display="none")}))}))})),document.addEventListener("DOMContentLoaded",(function(){initBlogLazy()}))}();