<!doctype html><html lang=zh-CN><head><title>折腾笔记[11]-使用rust进行直接法视觉里程计估计 | ByeIO·开发者博客</title><meta content=ByeIO·开发者博客 property=og:site_name><meta content=article property=og:type><meta content=折腾笔记[11]-使用rust进行直接法视觉里程计估计 property=og:title><meta content=//articles/docs/折腾笔记[11]-使用rust进行直接法视觉里程计估计/ property=og:url><meta content=使用rust实现了一个完整的直接法视觉里程计系统，能够通过比较两幅图像中的像素强度来估计相机的运动。它通过单层和多层的优化策略，… property=og:description><meta content=/processed_images/img00006.3250c5dc35a28271.webp property=og:image><meta content=summary_large_image name=twitter:card><meta content=折腾笔记[11]-使用rust进行直接法视觉里程计估计 name=twitter:title><meta content=//articles/docs/折腾笔记[11]-使用rust进行直接法视觉里程计估计/ name=twitter:url><meta content=使用rust实现了一个完整的直接法视觉里程计系统，能够通过比较两幅图像中的像素强度来估计相机的运动。它通过单层和多层的优化策略，… name=twitter:description><meta content=/processed_images/img00006.3250c5dc35a28271.webp name=twitter:image><meta content="使用rust实现了一个完整的直接法视觉里程计系统，能够通过比较两幅图像中的像素强度来估计相机的运动。它通过单层和多层的优化策略，结合图像金字塔和并行计算，提高了位姿估计的精度和效率。最终，代码输出了优化后的相机位姿变换矩阵，并可视化了投影点的位置。This is a complete direct meth…" name=description><script id=ld-json type=application/ld+json>
        {
          "@context": "https://schema.org/",
          "@type": "Article",
          "headline": "折腾笔记[11]-使用rust进行直接法视觉里程计估计",
          "author": {
            "@type": "Person",
            "name": "qsbye",
            "url": "/about"
          },
          "image": "/processed_images/img00006.c4abedc898f992a6.webp",
          "datePublished": "2025-01-01T00:00:00+00:00",
          
          "description": "使用rust实现了一个完整的直接法视觉里程计系统，能够通过比较两幅图像中的像素强度来估计相机的运动。它通过单层和多层的优化策略，结合图像金字塔和并行计算，提高了位姿估计的精度和效率。最终，代码输出了优化后的相机位姿变换矩阵，并可视化了投影点的位置。This is a complete direct method visual odometry system implemented in Rust, which estimates camera motion by comparing pixel intensities between two images. It employs both single-layer and multi-layer optimization strategies, combined with image pyramids and parallel computing, to enhance the accuracy and efficiency of pose estimation. Finally, the code outputs the optimized camera pose transformation matrix and visualizes the positions of the projected points."
        }
    </script><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1" name=viewport><meta content="telephone=no" name=format-detection><meta content=var(--wjx-card-bg) name=theme-color><link href=/manifest.json rel=manifest><link href=/img/avatar.png rel=icon type=image/x-icon><link href=/img/avatar.png rel=apple-touch-icon><link href=/img/avatar.png rel=bookmark><link href=/img/avatar.png rel=apple-touch-icon-precomposed sizes=180x180><script src=/libs/jquery/jquery-3.7.1.min.js></script><script src=/libs/pjax/pjax.min.js></script><script src=/production/js/utils.js></script><link href=/production/css/blog.css rel=stylesheet><link href=/css/custom.css rel=stylesheet><link onload="this.onload=null;this.rel='stylesheet'" as=style href=/libs/snackbar/snackbar.min.css rel=preload><noscript><link href=/libs/snackbar/snackbar.min.css rel=stylesheet></noscript><script>// Added non-passive event listener
  !function(e){"function"==typeof define&&define.amd?define(e):e()}(function(){var e,t=["scroll","wheel","touchstart","touchmove","touchenter","touchend","touchleave","mouseout","mouseleave","mouseup","mousedown","mousemove","mouseenter","mousewheel","mouseover"];if(function(){var e=!1;try{var t=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("test",null,t),window.removeEventListener("test",null,t)}catch(e){}return e}()){var n=EventTarget.prototype.addEventListener;e=n,EventTarget.prototype.addEventListener=function(n,o,r){var i,s="object"==typeof r&&null!==r,u=s?r.capture:r;(r=s?function(e){var t=Object.getOwnPropertyDescriptor(e,"passive");return t&&!0!==t.writable&&void 0===t.set?Object.assign({},e):e}(r):{}).passive=void 0!==(i=r.passive)?i:-1!==t.indexOf(n)&&!0,r.capture=void 0!==u&&u,e.call(this,n,o,r)},EventTarget.prototype.addEventListener._original=e}});</script><script>((win) => {
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return;
        const now = new Date();
        const expiryDay = ttl * 86400000;
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        };
        localStorage.setItem(key, JSON.stringify(item));
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key);

        if (!itemStr) {
          return undefined;
        }
        const item = JSON.parse(itemStr);
        const now = new Date();

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key);
          return undefined;
        }
        return item.value;
      },
    };

    win.getScript = (url) =>
      new Promise((resolve, reject) => {
        const script = document.createElement("script");
        script.src = url;
        script.async = true;
        script.onerror = reject;
        script.onload = script.onreadystatechange = function () {
          const loadState = this.readyState;
          if (loadState && loadState !== "loaded" && loadState !== "complete")
            return;
          script.onload = script.onreadystatechange = null;
          resolve();
        };
        document.head.appendChild(script);
      });

    win.getCSS = (url, id = false) =>
      new Promise((resolve, reject) => {
        const link = document.createElement("link");
        link.rel = "stylesheet";
        link.href = url;
        if (id) link.id = id;
        link.onerror = reject;
        link.onload = link.onreadystatechange = function () {
          const loadState = this.readyState;
          if (loadState && loadState !== "loaded" && loadState !== "complete")
            return;
          link.onload = link.onreadystatechange = null;
          resolve();
        };
        document.head.appendChild(link);
      });

    win.activateDarkMode = function () {
      document.documentElement.setAttribute("data-theme", "dark");
      document.documentElement.classList.add("color-scheme-dark");
      wjx.initThemeColor();
    };
    win.activateLightMode = function () {
      document.documentElement.setAttribute("data-theme", "light");
      document.documentElement.classList.remove("color-scheme-dark");
      wjx.initThemeColor();
    };
    const t = saveToLocal.get("theme");

    const isDarkMode = window.matchMedia(
      "(prefers-color-scheme: dark)"
    ).matches;
    const isLightMode = window.matchMedia(
      "(prefers-color-scheme: light)"
    ).matches;
    const isNotSpecified = window.matchMedia(
      "(prefers-color-scheme: no-preference)"
    ).matches;
    const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified;

    if (t === undefined) {
      if (isLightMode) activateLightMode();
      else if (isDarkMode) activateDarkMode();
      else if (isNotSpecified || hasNoSupport) {
        const now = new Date();
        const hour = now.getHours();
        const isNight = hour <= 6 || hour >= 18;
        isNight ? activateDarkMode() : activateLightMode();
      }
      window
        .matchMedia("(prefers-color-scheme: dark)")
        .addListener(function (e) {
          if (saveToLocal.get("theme") === undefined) {
            e.matches ? activateDarkMode() : activateLightMode();
          }
        });
    } else if (t === "light") activateLightMode();
    else activateDarkMode();

    if ("system" === "dark")
      activateDarkMode();
    else activateLightMode();

    const asideStatus = saveToLocal.get("aside-status");
    if (asideStatus !== undefined) {
      if (asideStatus === "hide") {
        document.documentElement.classList.add("hide-aside");
      } else {
        document.documentElement.classList.remove("hide-aside");
      }
    }
  })(window);</script><script data-pace-options='{ "restartOnRequestAfter":false,"eventLag":false}' src=/libs/pace/pace.min.js></script><script defer src=/libs/clipboard/clipboard.min.js></script><script src=/libs/countup/countup.js></script><link href=/icon/font.css rel=stylesheet><style>[data-theme=light]{--wjx-theme:#425aef!important;--wjx-theme-op:#425aef23!important;--wjx-theme-op-deep:#425aefdd!important;--wjx-theme-none:#425aef00!important}[data-theme=dark]{--wjx-theme:#f2b94b!important;--wjx-theme-op:#f2b94b23!important;--wjx-theme-op-deep:#f2b94bdd!important;--wjx-theme-none:#f2b94b00!important}:root{--halo-comment-widget-component-card-bg:var(--wjx-card-bg);--halo-comment-widget-component-theme-op:var(--wjx-theme-op);--halo-comment-widget-component-card-border:var(--wjx-card-border);--halo-comment-widget-component-shadow-border:var(--wjx-shadow-border);--halo-comment-widget-component-secondtext:var(--wjx-secondtext);--halo-comment-widget-component-lighttext:var(--wjx-lighttext);--halo-comment-widget-component-secondbg:var(--wjx-secondbg);--halo-comment-widget-component-fontcolor:var(--wjx-fontcolor);--halo-comment-widget-component-main:var(--wjx-main);--halo-comment-widget-component-background:var(--wjx-background);--halo-comment-widget-component-white:var(--wjx-white);--halo-comment-widget-component-shadow-black:var(--wjx-shadow-black)}#page{--halo-comment-widget-component-padding:1rem}.color-scheme-dark,.dark,[data-color-scheme=dark]{--halo-search-widget-color-modal-layer:var(--wjx-maskbgdeep);--halo-search-widget-color-modal-content-bg:var(--wjx-card-bg);--halo-search-widget-color-form-input:#fffc;--halo-search-widget-color-form-input-placeholder:#6b7280d9;--halo-search-widget-color-form-input-bg:var(--wjx-card-bg);--halo-search-widget-color-form-divider:#bbbbbb0f;--halo-search-widget-color-result-item-bg:var(--wjx-card-bg);--halo-search-widget-color-result-item-hover-bg:#90939914;--halo-search-widget-color-result-item-title:#fffc;--halo-search-widget-color-result-item-content:#ffffff82;--halo-search-widget-color-command-kbd-item:#c0c4ccb3;--halo-search-widget-color-command-kbd-border:#bbbbbb0f;--halo-search-widget-color-result-empty:#6b7280d9}[data-theme=light]{--halo-search-widget-color-result-item-title:#4b5563}</style><script id=site-config>var GLOBAL_CONFIG = {
        
                
        
        
        
        
        htmlType: "post",
        postTitle: "折腾笔记[11]-使用rust进行直接法视觉里程计估计",
        isPost: true,
        isHome: false,
        passageTip: {
            enable: true,
            day: 60,
        },
        copyright: {
            enable: false,
            limitCount: 10,
            languages: {
                author: " 作者：qsbye",
                link: " 链接：",
                source: " 来源：ByeIO·开发者博客",
                info: " 提示：著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处并保留原文链接。"
            }
        },
        lightbox: 'fancybox',
        rightMenuEnable: true,
        lazyload: {
            enable: true,
            error: "/img/404.svg"
        },
        isFriendLinksInFooter: true,
        loadingBox: true,
        progress_bar: true,
        navMusicEnable: false,
        isMusic: false,
        helloText: ["🤖️ 数码科技爱好者","🔯 全栈架构都在行","🏠 智能家居小能手","🤝 科研科普两不误","🎵 业余原创音乐人","🏃 文艺青年细节控","🔍 探索世界涉猎广","🤛 热爱分享交朋友"],
        profileStyle: "one",
        enable: true,
        keyboard: true,
        date_suffix: {
            just: '刚刚',
            min: '分钟前',
            hour: '小时前',
            day: '天前',
            month: '个月前'
        },
        Snackbar: {
            chs_to_cht: "你已切换为繁体",
            cht_to_chs: "你已切换为简体",
            day_to_night: "你已切换为深色模式",
            night_to_day: "你已切换为浅色模式",
            bgLight: "#425AEF",
            bgDark: "#f2b94b",
            position: "top-center"
        },
        translate: {
            defaultEncoding: "2",
            translateDelay: 0,
            msgToTraditionalChinese: "繁",
            msgToSimplifiedChinese: "简",
            rightMenuMsgToTraditionalChinese: "轉為繁體",
            rightMenuMsgToSimplifiedChinese: "转为简体"
        },
        prism: {
            enable: true,
            enable_title: true,
            enable_hr: true,
            enable_line: true,
            enable_copy: true,
            enable_expander: true,
            prism_limit: 330,
            enable_height_limit: false
        },
        
        source: {
            power: {
                powerLink: "/",
                showNum: 3
            },
            links: {
                linksUrl: "/friends",
                linksNum: 3
            },
            jQuery: '/libs/jquery/jquery.min.js',
            justifiedGallery: {
                js: '/libs/justified-gallery/fjGallery.min.js',
                css: '/libs/justified-gallery/fjGallery.css'
            },
            fancybox: {
                js: '/libs/fancybox/jquery.fancybox.min.js',
                css: '/null'
            },
            comments: {
                use: "twikoo",
                maxBarrage: 1,
                barrageTime: 4000,
                mailMd5: "",
                lazyload: false,
                textarea: "el-textarea__inner"
            },
            post: {
                dynamicBackground: true
            },
            tool: {
                switch: false
            },
            postAi: {
                
                gptName: "本地",
                modeName: "local"
            },twikoo: {
                js: "/libs/twikoo/twikoo.all.min.js",
                twikooUrl: "https://your-api-url",
            },
            footer: {
                default_enable: true
            },
            about: {
                
                rewardList: [],
                rewardAmount: 10
            }
        }
    };</script><style id=wjx-theme-styles>:root{--wjx-main:var(--wjx-theme)!important;--wjx-main-op:var(--wjx-theme-op)!important;--wjx-main-op-deep:var(--wjx-theme-op-deep)!important;--wjx-main-op-light:var(--wjx-theme-op-light)!important;--wjx-main-none:var(--wjx-theme-none)!important}</style><script>document.addEventListener('pjax:send', function () {
      // removeEventListener toc scroll
      window.removeEventListener('scroll', window.tocScrollFn);
      typeof preloader === 'object' && preloader.initLoading();
      
      if (window.aplayers) {
          for (let i = 0; i < window.aplayers.length; i++) {
              if (!window.aplayers[i].options.fixed) {
                  window.aplayers[i].destroy()
              }
          }
      }
      
      typeof typed === 'object' && typed.destroy();
      typeof window.initializationRegistry === 'object' && window.initializationRegistry.clear();
      
      //reset readmode
      const $bodyClassList = document.body.classList
      $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
  })
  document.addEventListener('pjax:complete', function () {
      window.refreshFn();
      
      document.querySelectorAll('script[data-pjax]').forEach(item => {
                  const newScript = document.createElement('script')
                  const content = item.text || item.textContent || item.innerHTML || ""
                  Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
                  newScript.appendChild(document.createTextNode(content))
                  item.parentNode.replaceChild(newScript, item)
              }
      );

      typeof chatBtnFn === 'function' && chatBtnFn();
      typeof panguInit === 'function' && panguInit();
      
      // google analytics
      typeof gtag === 'function' && gtag('config', '', {
          'page_path': window.location.pathname
      });
      
      // baidu analytics
      typeof _hmt === 'object' && _hmt.push(['_trackPageview', window.location.pathname]);
      
      typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting();
      
      // Analytics
      if (false) {
          MtaH5.pgv()
      }
      
      // prismjs
      typeof Prism === 'object' && Prism.highlightAll();
      
      typeof preloader === 'object' && preloader.endLoading();
  })
  document.addEventListener('pjax:error', (e) => {
      if (e.request.status === 404 || e.request.status === 500) {
          window.location.href = e.request.responseURL;
      }
  })</script><script data-pjax src=/production/js/main.js></script><script>let initTop = 0
  let isChatShow = true
  const innerHeight = window.innerHeight + 0
  window.addEventListener('scroll', btf.throttle(function (e) {
    const $rightside = document.getElementById('rightside')

    const $header = document.getElementById('page-header')
    const $cookies_window = document.getElementById('cookies-window')
    const isChatBtnHide = typeof chatBtnHide === 'function'
    const isChatBtnShow = typeof chatBtnShow === 'function'
  
    const currentTop = window.scrollY || document.documentElement.scrollTop
    // 找到滚动方向 true is down & false is up
    const isDown = currentTop > initTop
    initTop = currentTop
    if (currentTop > 0) {
        if (isDown) {
            if ($header.classList.contains('nav-visible')) $header.classList.remove('nav-visible')
            if (isChatBtnShow && isChatShow === true) {
                chatBtnHide()
                isChatShow = false
            }
        } else {
            if (!$header.classList.contains('nav-visible')) $header.classList.add('nav-visible')
            if (isChatBtnHide && isChatShow === false) {
                chatBtnShow()
                isChatShow = true
            }
        }
        $header.classList.add('nav-fixed')
        if($cookies_window!=null && $cookies_window!=''){
            $cookies_window.classList.add('cw-hide')
        }
        if ($rightside && window.getComputedStyle($rightside).getPropertyValue('opacity') === '0') {
            $rightside.style.cssText = 'opacity: 0.8; transform: translateX(-58px)'
        }
    } else {
        if (currentTop === 0) {
            $header.classList.remove('nav-fixed', 'nav-visible')
        }
        $rightside.style.cssText = "opacity: ''; transform: ''"
    }
    if (document.body.scrollHeight <= innerHeight) {
        $rightside.style.cssText = 'opacity: 0.8; transform: translateX(-58px)'
    }
  }, 200))</script><script defer src=/libs/katex/katex.min.js></script><body><style>#loading-box{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}#loading-box .loading-bg{background:var(--wjx-card-bg);z-index:1999;opacity:1;pointer-events:all;width:100%;height:100%;transition:all .2s;animation:.3s backwards showLoading;display:flex;position:fixed}#loading-box.loaded .loading-bg{pointer-events:none;transition:all .2s;animation:.3s forwards hideLoading}#loading-box .loading-img{width:100px;height:100px;margin:auto;animation-name:loadingAction;animation-duration:.2s;animation-iteration-count:infinite;animation-direction:alternate;overflow:hidden}#loading-box .loading-image-dot{background:#6bdf8f;border:6px solid #fff;border-radius:50%;width:30px;height:30px;position:absolute;top:50%;left:50%;-webkit-transform:translate(18px,24px);-moz-transform:translate(18px,24px);-ms-transform:translate(18px,24px);-o-transform:translate(18px,24px);transform:translate(18px,24px)}@keyframes loadingAction{0%{opacity:1}to{opacity:.6}}@keyframes hideLoading{0%{opacity:1}to{opacity:0}}@keyframes showLoading{0%{opacity:0}to{opacity:1}}</style><div id=loading-box onclick=wjx.hideLoading()><div class=loading-bg><picture class=loading-img style=border-radius:50%;width:100px;height:100px><source media="(min-width: 1em)" srcset=/processed_images/logo.21eeb8b123e2a315.avif><img alt=Loading decoding=async loading=lazy src=/processed_images/logo.caf14bfbf942dbfc.webp><noscript><img decoding=async loading=lazy src=/processed_images/logo.caf14bfbf942dbfc.webp></noscript></picture><div class=loading-image-dot></div></div></div><script>var preloader = {
            endLoading: () => {
                //- document.body.style.overflow = 'auto';
                document.getElementById('loading-box').classList.add("loaded")
            },
            initLoading: () => {
                //- document.body.style.overflow = '';
                document.getElementById('loading-box').classList.remove("loaded")
            }
        }
        window.addEventListener('load', preloader.endLoading())
        setTimeout(function () {
            preloader.endLoading();
        }, 3000)</script><div id=an_music_bg></div><div class=post data-type=post id=body-wrap><header class=post-bg id=page-header><nav class=show id=nav><div id=nav-group><div id=blog_name><div class=back-home-button tabindex=-1><i class="nav-icon back-home-button-icon icon-apps-fill" style=font-size:1rem></i><div class=back-menu-list-groups><div class=back-menu-list-group><div class=back-menu-list-title>作品</div><div class=back-menu-list><a class="back-menu-item nav-item" href=/articles/misc/lorem-ipsum>  <i class=icon-music style=font-size:.9em></i> <span class=back-menu-item-text>Lorem Ipsum</span> </a><a class="back-menu-item nav-item" href=/articles/misc/lorem-ipsum>  <i class=icon-music style=font-size:.9em></i> <span class=back-menu-item-text>Lorem Ipsum</span> </a></div></div></div></div><a class="nav-item icon-home" data-pjax href=/ id=site-name title=返回博客主页> <span>ByeIO·开发者博客</span> </a></div><div id=page-name-mask><div id=page-name><a clase=nav-item id=page-name-text onclick=btf.scrollToDest(0,500)> 折腾笔记[11]-使用rust进行直接法视觉里程计估计 </a></div></div><div id=menus><div class=menus_items><div class=menus_item><button class="site-page nav-item"><span>文库</span></button><div class=menus_item_child><div class=recursion_menus_item><a class="site-page child nav-item" href=/archives> <i class=icon-book-open style=font-size:.9em></i> <span>全部文章</span> </a></div><div class=recursion_menus_item><a class="site-page child nav-item" href=/categories> <i class=icon-folder-open style=font-size:.9em></i> <span>分类列表</span> </a></div><div class=recursion_menus_item><a class="site-page child nav-item" href=/tags> <i class=icon-tags style=font-size:.9em></i> <span>标签列表</span> </a></div><div class=recursion_menus_item><a class="site-page child nav-item" href=javascript:toRandomPost()> <i class=icon-artstation style=font-size:.9em></i> <span>随机文章</span> </a></div></div></div><div class=menus_item><a class="site-page nav-item" href=/tags/work> <span>推荐</span> </a><div class="menus_item_child vertical_nav"><div class=recursion_menus_item><a class="site-page child nav-item" href=/articles/docs/readme> <i class=icon-music style=font-size:.9em></i> <span>博客主题介绍</span> </a></div><div class=recursion_menus_item><a class="site-page child nav-item" href=/articles/misc/lorem-ipsum> <i class=icon-music style=font-size:.9em></i> <span>Lorem Ipsum</span> </a></div></div></div><div class=menus_item><button class="site-page nav-item"><span>友链</span></button><div class=menus_item_child><div class=recursion_menus_item><a class="site-page child nav-item" href=/friends> <i class=icon-link style=font-size:.9em></i> <span>友链列表</span> </a></div><div class=recursion_menus_item><a class="site-page child nav-item" href=javascript:travelling()> <i class=icon-paper-plane style=font-size:.9em></i> <span>随机发现</span> </a></div></div></div><div class=menus_item><button class="site-page nav-item"><span>我的</span></button><div class=menus_item_child><div class=recursion_menus_item><a class="site-page child nav-item" href=/about> <i class=icon-rocket style=font-size:.9em></i> <span>关于本人</span> </a></div><div class=recursion_menus_item><a class="site-page child nav-item" href=/equipment> <i class=icon-artstation style=font-size:.9em></i> <span>我的装备</span> </a></div><div class=recursion_menus_item><a class="site-page child nav-item" href=/tags/project> <i class=icon-lightbulb style=font-size:.9em></i> <span>我的项目</span> </a></div></div></div></div></div><div id=nav-right><div class=nav-button id=randomPost_button><button class="site-page nav-item" href=javascript:void(0); onclick=toRandomPost() title=随机文章><i class="nav-icon icon-dice"></i></button></div><div class=nav-button id=darkmode_button><button class="site-page console_switchbutton nav-item" title="切换模式 - 日夜交替，黑白互换。" href=javascript:void(0); onclick=navFn.switchDarkMode();><i class="nav-icon icon-moon-clear-fill" style=font-size:1rem></i></button></div><div class=nav-button id=nav-console><button class="site-page console_switchbutton nav-item" href=javascript:void(0); onclick=wjx.showConsole() title=显示中控台><i class="nav-icon icon-dashboard"></i></button></div><div class=nav-button id=nav-totop onclick=btf.scrollToDest(0,500)><button class="totopbtn nav-item"><i class="nav-icon icon-arrow-up" style=font-size:1rem></i><span id=percent>0</span></button></div><div id=toggle-menu><button class="site-page nav-item"><i class="nav-icon icon-bars"></i></button></div></div></div></nav><div class="coverdiv loaded" id=coverdiv><img alt=cover class=nolazyload decoding=async id=post-cover loading=lazy src=/processed_images/img00006.c4abedc898f992a6.webp></div><div id=post-info><div id=post-firstinfo><div class=meta-firstline><a class=post-meta-original href=/copyright title=该文章为原创文章，注意版权协议>原创</a><span class=post-meta-categories> <a href=/categories/theme/ title=主题> 主题 </a> </span><div class=tag_share><div class=post-meta__tag-list><a class=post-meta__tags href=/tags/blog/ title=博客> <span class="tags-name tags-punctuation">博客</span> </a><a class=post-meta__tags href=/tags/docs/ title=文档> <span class="tags-name tags-punctuation">文档</span> </a><a class=post-meta__tags href=/tags/featured/ title=必看> <span class="tags-name tags-punctuation">必看</span> </a><a class=post-meta__tags href=/tags/hot/ title=热门> <span class="tags-name tags-punctuation">热门</span> </a></div></div></div></div><h1 class=post-title>折腾笔记[11]-使用rust进行直接法视觉里程计估计</h1><div id=post-meta><div class=meta-secondline><span class=post-meta-author data-flag-title=文章作者 title=文章作者> <i class="icon-zuozhe post-meta-icon"></i>qsbye </span><span class=post-meta-wordcount> <i class="icon-file-word post-meta-icon" title=字数></i> <span class=post-meta-label>字数:</span> <span class=word-count>2227</span> <span class=post-meta-separator></span> <i class="icon-clock post-meta-icon" title=阅读耗时></i> <span class=post-meta-label>阅读耗时:</span> <span> 12 分钟</span> </span><span class=post-meta-date> <i class="icon-calendar-days post-meta-icon"></i> <time title="2025-01-01 00:00:00" datetime=2025-01-01> 2025/01/01 </time> </span><span class=post-meta-wechat title=该文章在博客首发> <i class="icon-rss post-meta-icon"></i>博客独享 </span><a class=post-meta-pv data-flag-title=热度 title=热度> <i class="icon-fire post-meta-icon"></i> <span class=post-meta-label>热度:</span> <span id=twikoo_visitors> <i class="icon-spinner fa-spin"></i> </span> </a><a class=post-meta-commentcount data-flag-title=评论数 href=#post-comment title=评论数> <i class="icon-chat--fill post-meta-icon" style=font-size:17px></i> <span class=post-meta-label>评论:</span> <span id=twikoo-count> <i class="icon-spinner fa-spin"></i> </span> </a></div></div></div><section class="main-hero-waves-area waves-area"><svg viewbox="0 24 150 28" class=waves-svg preserveaspectratio=none shape-rendering=auto xlink=http://www.w3.org/1999/xlink xmlns=http://www.w3.org/2000/svg><defs><path d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z" id=gentle-wave></path></defs><g class=parallax><use href=#gentle-wave x=48 y=0></use><use href=#gentle-wave x=48 y=3></use><use href=#gentle-wave x=48 y=5></use><use href=#gentle-wave x=48 y=7></use></g></svg></section></header><main class="layout right-aside" id=content-inner><div id=post><div id=abstract-container><div class=abstract-title><i class=icon-bilibili></i><div class=abstract-title-text>文章摘要</div><div id=abstract-tag>本地</div></div><div id=abstract-content style=display:block>使用rust实现了一个完整的直接法视觉里程计系统，能够通过比较两幅图像中的像素强度来估计相机的运动。它通过单层和多层的优化策略，结合图像金字塔和并行计算，提高了位姿估计的精度和效率。最终，代码输出了优化后的相机位姿变换矩阵，并可视化了投影点的位置。This is a complete direct method visual odometry system implemented in Rust, which estimates camera motion by comparing pixel intensities between two images. It employs both single-layer and multi-layer optimization strategies, combined with image pyramids and parallel computing, to enhance the accuracy and efficiency of pose estimation. Finally, the code outputs the optimized camera pose transformation matrix and visualizes the positions of the projected points.</div><div class=abstract-btn-box><div class=abstract-btn-item id=abstract-intro>介绍自己</div><div class=abstract-btn-item id=abstract-generate>生成本文简介</div><div class=abstract-btn-item id=abstract-recommend>推荐相关文章</div><div class=abstract-btn-item id=abstract-home>前往主页</div><div class=abstract-btn-item id=abstract-hide style=margin-left:auto>隐藏本摘要</div></div></div><div class="note simple warning" data-tip-enable=true data-update-date=2025-01-01 id=passage-tip></div><article class="post-content line-numbers" id=article-container><h2 id=zhai-yao>摘要</h2><p>使用rust实现了一个完整的直接法视觉里程计系统，能够通过比较两幅图像中的像素强度来估计相机的运动。它通过单层和多层的优化策略，结合图像金字塔和并行计算，提高了位姿估计的精度和效率。最终，代码输出了优化后的相机位姿变换矩阵，并可视化了投影点的位置。 This is a complete direct method visual odometry system implemented in Rust, which estimates camera motion by comparing pixel intensities between two images. It employs both single-layer and multi-layer optimization strategies, combined with image pyramids and parallel computing, to enhance the accuracy and efficiency of pose estimation. Finally, the code outputs the optimized camera pose transformation matrix and visualizes the positions of the projected points.<h2 id=guan-jian-ci>关键词</h2><p>rust;slam;visual odometry;<h2 id=guan-jian-xin-xi>关键信息</h2><p><strong>项目地址</strong>:[https://github.com/ByeIO/slambook2.rs]<pre class=language-toml data-lang=toml><code class=language-toml data-lang=toml>[package]
name = "exp65-rust-ziglang-slambook2"
version = "0.1.0"
edition = "2021"

[dependencies]
env_logger = { version = "0.11.6", default-features = false, features = [
    "auto-color",
    "humantime",
] }

# 随机数
rand = "0.8.5"
rand_distr = "0.4.3"
fastrand = "2.3.0"

# 线性代数
nalgebra = { version = "0.33.2",features = ["rand"]}
ndarray = "0.16.1"

# winit
wgpu = "23.0.1"
winit = "0.30.8"

# egui
eframe = "0.30.0"
egui = { version = "0.30.0", features = [
    "default"
]}
egui_extras = {version = "0.30.0",features = ["default", "image"]}

# three_d
three-d = {path = "./static/three-d" , features=["egui-gui"] }
three-d-asset = {version = "0.9",features = ["hdr", "http"] }

# sophus
sophus = { version = "0.11.0" }
sophus_autodiff = { version = "0.11.0" }
sophus_geo = "0.11.0"
sophus_image = "0.11.0"
sophus_lie = "0.11.0"
sophus_opt = "0.11.0"
sophus_renderer = "0.11.0"
sophus_sensor = "0.11.0"
sophus_sim = "0.11.0"
sophus_spline = "0.11.0"
sophus_tensor = "0.11.0"
sophus_timeseries = "0.11.0"
sophus_viewer = "0.11.0"
tokio = "1.43.0"
approx = "0.5.1"
bytemuck = "1.21.0"
thingbuf = "0.1.6"

# rust-cv计算机视觉
cv = { version = "0.6.0" , features = ["default"] }
cv-core = "0.15.0"
cv-geom = "0.7.0"
cv-pinhole = "0.6.0"
akaze = "0.7.0"
eight-point = "0.8.0"
lambda-twist = "0.7.0"
image = "0.25.5"
imageproc = "0.25.0"

# 最小二乘优化
gomez = "0.5.0"

# 图优化
factrs = "0.2.0"

# ORB角点检测
bye_orb_rs = { path = "./static/bye_orb_rs" }

# 依赖覆盖
[patch.crates-io]
pulp = { path = "./static/pulp" }
</code></pre><h2 id=yuan-li-jian-jie>原理简介</h2><h3 id=shi-jue-li-cheng-ji-jian-jie>视觉里程计简介</h3><p>视觉里程计（Visual Odometry, VO）是一种通过分析图像序列来估计相机运动的技术。主要有直接法和光流法。<h4 id=1-zhi-jie-fa>1. 直接法</h4><p>直接法通过最小化图像间的光度误差来估计相机运动。假设在图像序列中，像素的光度值在相邻帧之间保持不变，即：<p>$$ I_1(\mathbf{x}) = I_2(\mathbf{x} + \mathbf{d}) $$<p>其中，$I_1$ 和 $I_2$ 分别是第一帧和第二帧的图像，$\mathbf{x}$ 是像素坐标，$\mathbf{d}$ 是像素的位移。<p>为了估计相机的位姿变化，我们需要最小化以下光度误差：<p>$$ E(\mathbf{d}) = \sum_{\mathbf{x}} \left( I_1(\mathbf{x}) - I_2(\mathbf{x} + \mathbf{d}) \right)^2 $$<p>通过对误差函数 $E(\mathbf{d})$ 进行优化，可以得到像素的位移 $\mathbf{d}$，进而推导出相机的运动。<h4 id=2-guang-liu-fa>2. 光流法</h4><p>光流法通过估计图像序列中像素的运动矢量场来推断相机运动。光流法假设在短时间内，图像中物体的运动是平滑的。光流约束方程为：<p>$$ I(x, y, t) = I(x + u, y + v, t + 1) $$<p>其中，$(u, v)$ 是光流矢量，表示像素在图像平面上的位移。<p>为了求解光流矢量，通常使用泰勒展开对上述方程进行线性化，得到：<p>$$ \frac{\partial I}{\partial x} u + \frac{\partial I}{\partial y} v + \frac{\partial I}{\partial t} = 0 $$<p>这个方程称为光流约束方程。通过对多个像素点的光流约束方程进行求解，可以得到整个图像的光流场。<p>这两种方法各有优缺点，直接法利用了图像的全部像素信息，适用于纹理丰富的场景；而光流法适用于实时应用，计算相对简单。<h3 id=ya-ke-bi-ju-zhen-jian-jie>雅可比矩阵简介</h3><p>雅可比矩阵（Jacobian Matrix）是一个重要的数学工具，用于描述多变量函数的偏导数。它在许多领域中都有应用，包括优化、控制理论和计算机视觉等。<h4 id=1-ya-ke-bi-ju-zhen-de-ding-yi>1. 雅可比矩阵的定义</h4><p>对于一个向量值函数 $\mathbf{f} : \mathbb{R}^n \to \mathbb{R}^m$，其雅可比矩阵是一个 $m \times n$ 的矩阵，矩阵中的每个元素是函数 $\mathbf{f}$ 的分量对输入变量的偏导数。具体来说，雅可比矩阵 $J$ 的元素 $J_{ij}$ 是函数 $\mathbf{f}_i$ 对变量 $x_j$ 的偏导数：<p>$$ J_{ij} = \frac{\partial \mathbf{f}_i}{\partial x_j} $$<p>因此，雅可比矩阵可以表示为：<p>$$ J = \begin{bmatrix} \frac{\partial \mathbf{f}_1}{\partial x_1} & \cdots & \frac{\partial \mathbf{f}_1}{\partial x_n} \ \vdots & \ddots & \vdots \ \frac{\partial \mathbf{f}_m}{\partial x_1} & \cdots & \frac{\partial \mathbf{f}_m}{\partial x_n} \end{bmatrix} $$<h4 id=2-ying-yong>2. 应用</h4><ol><li><p><strong>优化问题</strong>：在优化问题中，雅可比矩阵用于描述目标函数的梯度信息，帮助优化算法找到函数的极值点。</p><li><p><strong>非线性方程组求解</strong>：在求解非线性方程组时，雅可比矩阵用于线性化方程组，从而应用迭代方法（如牛顿法）进行求解。</p><li><p><strong>计算机视觉</strong>：在计算机视觉中，雅可比矩阵用于描述图像坐标变化对相机参数变化的敏感性，常用于视觉里程计和三维重建等应用。</p></ol><p>雅可比矩阵是一个强大的工具，能够有效地描述多变量函数的局部线性近似，从而在许多实际问题中发挥重要作用。<h3 id=tu-xiang-jin-zi-ta-jian-jie>图像金字塔简介</h3><p>图像金字塔是一种多分辨率图像表示方法，通过将图像逐层缩小，形成一系列不同分辨率的图像。图像金字塔在计算机视觉中有广泛的应用，尤其是在图像处理、特征检测和匹配等领域。<h4 id=1-tu-xiang-jin-zi-ta-de-lei-xing>1. 图像金字塔的类型</h4><ol><li><p><strong>高斯金字塔（Gaussian Pyramid）</strong>：</p> <ul><li>通过对图像进行高斯模糊，然后下采样（通常是缩小一半）来构建。<li>每一层都是上一层的低通滤波版本，主要用于图像平滑和降噪。</ul><li><p><strong>拉普拉斯金字塔（Laplacian Pyramid）</strong>：</p> <ul><li>由高斯金字塔构建，通过从每一层的高斯金字塔中减去其下一层的上采样版本得到。<li>用于图像的边缘检测和增强。</ul></ol><h4 id=2-tu-xiang-jin-zi-ta-de-gou-jian>2. 图像金字塔的构建</h4><p>在代码中，图像金字塔的构建过程如下：<pre class=language-cpp data-lang=cpp><code class=language-cpp data-lang=cpp>// create pyramids
vector&LTcv::Mat> pyr1, pyr2; // image pyramids
for (int i = 0; i < pyramids; i++) {
    if (i == 0) {
        pyr1.push_back(img1);
        pyr2.push_back(img2);
    } else {
        cv::Mat img1_pyr, img2_pyr;
        cv::resize(pyr1[i - 1], img1_pyr,
                   cv::Size(pyr1[i - 1].cols * pyramid_scale, pyr1[i - 1].rows * pyramid_scale));
        cv::resize(pyr2[i - 1], img2_pyr,
                   cv::Size(pyr2[i - 1].cols * pyramid_scale, pyr2[i - 1].rows * pyramid_scale));
        pyr1.push_back(img1_pyr);
        pyr2.push_back(img2_pyr);
    }
}
</code></pre><p>在这个过程中，图像被逐层缩小，形成一个金字塔结构。每一层的图像分辨率是上一层的 <code>pyramid_scale</code> 倍（通常是0.5），即每层的宽度和高度都是上一层的一半。<h4 id=3-ying-yong>3. 应用</h4><ul><li><strong>特征检测和匹配</strong>：在不同分辨率下检测特征，可以提高特征匹配的鲁棒性。<li><strong>图像融合</strong>：在多分辨率下进行图像融合，可以减少融合过程中的伪影。<li><strong>图像压缩</strong>：通过金字塔结构，可以实现图像的渐进式传输和压缩。</ul><p>图像金字塔通过提供多分辨率的图像表示，能够有效地处理不同尺度下的图像信息，是计算机视觉中一个重要的工具。<h3 id=tu-xiang-shuang-xian-xing-cha-zhi-jian-jie>图像双线性插值简介</h3><p>双线性插值是一种用于图像处理的插值方法，用于在图像缩放、旋转或变形时计算非整数像素位置的像素值。它通过对周围的四个像素进行加权平均来估计目标像素的值。<p>假设我们有一个图像，目标是计算位置 $(x, y)$ 的像素值，其中 $x$ 和 $y$ 不是整数。双线性插值的步骤如下：<ol><li><p><strong>确定邻近的四个像素</strong>：</p> <ul><li>找到包含 $(x, y)$ 的四个最近的整数像素点：$(x_1, y_1)$、$(x_1+1, y_1)$、$(x_1, y_1+1)$、$(x_1+1, y_1+1)$。</ul><li><p><strong>计算水平插值</strong>：</p> <ul><li>对 $x$ 方向进行插值，得到两个中间值： $$ f(x, y_1) = (x_1+1 - x) \cdot f(x_1, y_1) + (x - x_1) \cdot f(x_1+1, y_1) $$ $$ f(x, y_1+1) = (x_1+1 - x) \cdot f(x_1, y_1+1) + (x - x_1) \cdot f(x_1+1, y_1+1) $$</ul><li><p><strong>计算垂直插值</strong>：</p> <ul><li>对 $y$ 方向进行插值，得到最终的插值值： $$ f(x, y) = (y_1+1 - y) \cdot f(x, y_1) + (y - y_1) \cdot f(x, y_1+1) $$</ul></ol><h2 id=shi-xian>实现</h2><ol><li>原始cpp代码[https://github.com/gaoxiang12/slambook2/blob/master/ch8/direct_method.cpp]</ol><pre class=language-cpp data-lang=cpp><code class=language-cpp data-lang=cpp>#include &LTopencv2/opencv.hpp>
#include &LTsophus/se3.hpp>
#include &LTboost/format.hpp>
#include &LTpangolin/pangolin.h>

using namespace std;

typedef vector&LTEigen::Vector2d, Eigen::aligned_allocator&LTEigen::Vector2d>> VecVector2d;

// Camera intrinsics
double fx = 718.856, fy = 718.856, cx = 607.1928, cy = 185.2157;
// baseline
double baseline = 0.573;
// paths
string left_file = "./left.png";
string disparity_file = "./disparity.png";
boost::format fmt_others("./%06d.png");    // other files

// useful typedefs
typedef Eigen::Matrix&LTdouble, 6, 6> Matrix6d;
typedef Eigen::Matrix&LTdouble, 2, 6> Matrix26d;
typedef Eigen::Matrix&LTdouble, 6, 1> Vector6d;

/// class for accumulator jacobians in parallel
class JacobianAccumulator {
public:
    JacobianAccumulator(
        const cv::Mat &img1_,
        const cv::Mat &img2_,
        const VecVector2d &px_ref_,
        const vector&LTdouble> depth_ref_,
        Sophus::SE3d &T21_) :
        img1(img1_), img2(img2_), px_ref(px_ref_), depth_ref(depth_ref_), T21(T21_) {
        projection = VecVector2d(px_ref.size(), Eigen::Vector2d(0, 0));
    }

    /// accumulate jacobians in a range
    void accumulate_jacobian(const cv::Range &range);

    /// get hessian matrix
    Matrix6d hessian() const { return H; }

    /// get bias
    Vector6d bias() const { return b; }

    /// get total cost
    double cost_func() const { return cost; }

    /// get projected points
    VecVector2d projected_points() const { return projection; }

    /// reset h, b, cost to zero
    void reset() {
        H = Matrix6d::Zero();
        b = Vector6d::Zero();
        cost = 0;
    }

private:
    const cv::Mat &img1;
    const cv::Mat &img2;
    const VecVector2d &px_ref;
    const vector&LTdouble> depth_ref;
    Sophus::SE3d &T21;
    VecVector2d projection; // projected points

    std::mutex hessian_mutex;
    Matrix6d H = Matrix6d::Zero();
    Vector6d b = Vector6d::Zero();
    double cost = 0;
};

/**
 * pose estimation using direct method
 * @param img1
 * @param img2
 * @param px_ref
 * @param depth_ref
 * @param T21
 */
void DirectPoseEstimationMultiLayer(
    const cv::Mat &img1,
    const cv::Mat &img2,
    const VecVector2d &px_ref,
    const vector&LTdouble> depth_ref,
    Sophus::SE3d &T21
);

/**
 * pose estimation using direct method
 * @param img1
 * @param img2
 * @param px_ref
 * @param depth_ref
 * @param T21
 */
void DirectPoseEstimationSingleLayer(
    const cv::Mat &img1,
    const cv::Mat &img2,
    const VecVector2d &px_ref,
    const vector&LTdouble> depth_ref,
    Sophus::SE3d &T21
);

// bilinear interpolation
inline float GetPixelValue(const cv::Mat &img, float x, float y) {
    // boundary check
    if (x < 0) x = 0;
    if (y < 0) y = 0;
    if (x >= img.cols) x = img.cols - 1;
    if (y >= img.rows) y = img.rows - 1;
    uchar *data = &img.data[int(y) * img.step + int(x)];
    float xx = x - floor(x);
    float yy = y - floor(y);
    return float(
        (1 - xx) * (1 - yy) * data[0] +
        xx * (1 - yy) * data[1] +
        (1 - xx) * yy * data[img.step] +
        xx * yy * data[img.step + 1]
    );
}

int main(int argc, char **argv) {

    cv::Mat left_img = cv::imread(left_file, 0);
    cv::Mat disparity_img = cv::imread(disparity_file, 0);

    // let's randomly pick pixels in the first image and generate some 3d points in the first image's frame
    cv::RNG rng;
    int nPoints = 2000;
    int boarder = 20;
    VecVector2d pixels_ref;
    vector&LTdouble> depth_ref;

    // generate pixels in ref and load depth data
    for (int i = 0; i < nPoints; i++) {
        int x = rng.uniform(boarder, left_img.cols - boarder);  // don't pick pixels close to boarder
        int y = rng.uniform(boarder, left_img.rows - boarder);  // don't pick pixels close to boarder
        int disparity = disparity_img.at&LTuchar>(y, x);
        double depth = fx * baseline / disparity; // you know this is disparity to depth
        depth_ref.push_back(depth);
        pixels_ref.push_back(Eigen::Vector2d(x, y));
    }

    // estimates 01~05.png's pose using this information
    Sophus::SE3d T_cur_ref;

    for (int i = 1; i < 6; i++) {  // 1~10
        cv::Mat img = cv::imread((fmt_others % i).str(), 0);
        // try single layer by uncomment this line
        // DirectPoseEstimationSingleLayer(left_img, img, pixels_ref, depth_ref, T_cur_ref);
        DirectPoseEstimationMultiLayer(left_img, img, pixels_ref, depth_ref, T_cur_ref);
    }
    return 0;
}

void DirectPoseEstimationSingleLayer(
    const cv::Mat &img1,
    const cv::Mat &img2,
    const VecVector2d &px_ref,
    const vector&LTdouble> depth_ref,
    Sophus::SE3d &T21) {

    const int iterations = 10;
    double cost = 0, lastCost = 0;
    auto t1 = chrono::steady_clock::now();
    JacobianAccumulator jaco_accu(img1, img2, px_ref, depth_ref, T21);

    for (int iter = 0; iter < iterations; iter++) {
        jaco_accu.reset();
        cv::parallel_for_(cv::Range(0, px_ref.size()),
                          std::bind(&JacobianAccumulator::accumulate_jacobian, &jaco_accu, std::placeholders::_1));
        Matrix6d H = jaco_accu.hessian();
        Vector6d b = jaco_accu.bias();

        // solve update and put it into estimation
        Vector6d update = H.ldlt().solve(b);;
        T21 = Sophus::SE3d::exp(update) * T21;
        cost = jaco_accu.cost_func();

        if (std::isnan(update[0])) {
            // sometimes occurred when we have a black or white patch and H is irreversible
            cout << "update is nan" << endl;
            break;
        }
        if (iter > 0 && cost > lastCost) {
            cout << "cost increased: " << cost << ", " << lastCost << endl;
            break;
        }
        if (update.norm() < 1e-3) {
            // converge
            break;
        }

        lastCost = cost;
        cout << "iteration: " << iter << ", cost: " << cost << endl;
    }

    cout << "T21 = \n" << T21.matrix() << endl;
    auto t2 = chrono::steady_clock::now();
    auto time_used = chrono::duration_cast&LTchrono::duration&LTdouble>>(t2 - t1);
    cout << "direct method for single layer: " << time_used.count() << endl;

    // plot the projected pixels here
    cv::Mat img2_show;
    cv::cvtColor(img2, img2_show, CV_GRAY2BGR);
    VecVector2d projection = jaco_accu.projected_points();
    for (size_t i = 0; i < px_ref.size(); ++i) {
        auto p_ref = px_ref[i];
        auto p_cur = projection[i];
        if (p_cur[0] > 0 && p_cur[1] > 0) {
            cv::circle(img2_show, cv::Point2f(p_cur[0], p_cur[1]), 2, cv::Scalar(0, 250, 0), 2);
            cv::line(img2_show, cv::Point2f(p_ref[0], p_ref[1]), cv::Point2f(p_cur[0], p_cur[1]),
                     cv::Scalar(0, 250, 0));
        }
    }
    cv::imshow("current", img2_show);
    cv::waitKey();
}

void JacobianAccumulator::accumulate_jacobian(const cv::Range &range) {

    // parameters
    const int half_patch_size = 1;
    int cnt_good = 0;
    Matrix6d hessian = Matrix6d::Zero();
    Vector6d bias = Vector6d::Zero();
    double cost_tmp = 0;

    for (size_t i = range.start; i < range.end; i++) {

        // compute the projection in the second image
        Eigen::Vector3d point_ref =
            depth_ref[i] * Eigen::Vector3d((px_ref[i][0] - cx) / fx, (px_ref[i][1] - cy) / fy, 1);
        Eigen::Vector3d point_cur = T21 * point_ref;
        if (point_cur[2] < 0)   // depth invalid
            continue;

        float u = fx * point_cur[0] / point_cur[2] + cx, v = fy * point_cur[1] / point_cur[2] + cy;
        if (u < half_patch_size || u > img2.cols - half_patch_size || v < half_patch_size ||
            v > img2.rows - half_patch_size)
            continue;

        projection[i] = Eigen::Vector2d(u, v);
        double X = point_cur[0], Y = point_cur[1], Z = point_cur[2],
            Z2 = Z * Z, Z_inv = 1.0 / Z, Z2_inv = Z_inv * Z_inv;
        cnt_good++;

        // and compute error and jacobian
        for (int x = -half_patch_size; x <= half_patch_size; x++)
            for (int y = -half_patch_size; y <= half_patch_size; y++) {

                double error = GetPixelValue(img1, px_ref[i][0] + x, px_ref[i][1] + y) -
                               GetPixelValue(img2, u + x, v + y);
                Matrix26d J_pixel_xi;
                Eigen::Vector2d J_img_pixel;

                J_pixel_xi(0, 0) = fx * Z_inv;
                J_pixel_xi(0, 1) = 0;
                J_pixel_xi(0, 2) = -fx * X * Z2_inv;
                J_pixel_xi(0, 3) = -fx * X * Y * Z2_inv;
                J_pixel_xi(0, 4) = fx + fx * X * X * Z2_inv;
                J_pixel_xi(0, 5) = -fx * Y * Z_inv;

                J_pixel_xi(1, 0) = 0;
                J_pixel_xi(1, 1) = fy * Z_inv;
                J_pixel_xi(1, 2) = -fy * Y * Z2_inv;
                J_pixel_xi(1, 3) = -fy - fy * Y * Y * Z2_inv;
                J_pixel_xi(1, 4) = fy * X * Y * Z2_inv;
                J_pixel_xi(1, 5) = fy * X * Z_inv;

                J_img_pixel = Eigen::Vector2d(
                    0.5 * (GetPixelValue(img2, u + 1 + x, v + y) - GetPixelValue(img2, u - 1 + x, v + y)),
                    0.5 * (GetPixelValue(img2, u + x, v + 1 + y) - GetPixelValue(img2, u + x, v - 1 + y))
                );

                // total jacobian
                Vector6d J = -1.0 * (J_img_pixel.transpose() * J_pixel_xi).transpose();

                hessian += J * J.transpose();
                bias += -error * J;
                cost_tmp += error * error;
            }
    }

    if (cnt_good) {
        // set hessian, bias and cost
        unique_lock&LTmutex> lck(hessian_mutex);
        H += hessian;
        b += bias;
        cost += cost_tmp / cnt_good;
    }
}

void DirectPoseEstimationMultiLayer(
    const cv::Mat &img1,
    const cv::Mat &img2,
    const VecVector2d &px_ref,
    const vector&LTdouble> depth_ref,
    Sophus::SE3d &T21) {

    // parameters
    int pyramids = 4;
    double pyramid_scale = 0.5;
    double scales[] = {1.0, 0.5, 0.25, 0.125};

    // create pyramids
    vector&LTcv::Mat> pyr1, pyr2; // image pyramids
    for (int i = 0; i < pyramids; i++) {
        if (i == 0) {
            pyr1.push_back(img1);
            pyr2.push_back(img2);
        } else {
            cv::Mat img1_pyr, img2_pyr;
            cv::resize(pyr1[i - 1], img1_pyr,
                       cv::Size(pyr1[i - 1].cols * pyramid_scale, pyr1[i - 1].rows * pyramid_scale));
            cv::resize(pyr2[i - 1], img2_pyr,
                       cv::Size(pyr2[i - 1].cols * pyramid_scale, pyr2[i - 1].rows * pyramid_scale));
            pyr1.push_back(img1_pyr);
            pyr2.push_back(img2_pyr);
        }
    }

    double fxG = fx, fyG = fy, cxG = cx, cyG = cy;  // backup the old values
    for (int level = pyramids - 1; level >= 0; level--) {
        VecVector2d px_ref_pyr; // set the keypoints in this pyramid level
        for (auto &px: px_ref) {
            px_ref_pyr.push_back(scales[level] * px);
        }

        // scale fx, fy, cx, cy in different pyramid levels
        fx = fxG * scales[level];
        fy = fyG * scales[level];
        cx = cxG * scales[level];
        cy = cyG * scales[level];
        DirectPoseEstimationSingleLayer(pyr1[level], pyr2[level], px_ref_pyr, depth_ref, T21);
    }

}
</code></pre><ol start=2><li>重构的rust代码</ol><pre class=language-rs data-lang=rs><code class=language-rs data-lang=rs>#![allow(dead_code)]
#![allow(unused_variables)]
#![allow(unused_imports)]
#![allow(unused_mut)]
#![allow(unused_assignments)]
#![cfg_attr(not(debug_assertions), windows_subsystem = "windows")]
#![allow(rustdoc::missing_crate_level_docs)]
#![allow(unsafe_code)]
#![allow(clippy::undocumented_unsafe_blocks)]
#![allow(unused_must_use)]
#![allow(non_snake_case)]

// 线性代数
use nalgebra::{
    DMatrix, DVector, Matrix3, Vector3, 
    Vector2, Matrix6, Vector6, Matrix2x6, 
    SMatrix, SVector
};

// 图像处理
use image::{
    open, ImageBuffer, Rgb, DynamicImage, Luma, RgbImage,
    buffer::ConvertBuffer
};
use imageproc::{
    drawing::draw_cross_mut, drawing::draw_line_segment_mut
};

// ORB角点检测
use bye_orb_rs::{
    orb, fast, common::Matchable
};

// 图优化
use factrs::{
    assign_symbols,
    core::{BetweenResidual, GaussNewton, Graph, Values},
    dtype, fac,
    linalg::{Const, ForwardProp, Numeric, NumericalDiff, VectorX, DiffResult, MatrixX},
    residuals::Residual1,
    traits::*,
    variables::{VectorVar2, SE2, VectorVar3, SE3, SO2, SO3, MatrixLieGroup},
    containers::Key,
    noise::{GaussianNoise}
};

// 随机数
use rand::{
    Rng, SeedableRng
};
use rand::distributions::{
    Distribution, Uniform
};

// 时间
use std::time::Instant;

// 引用单元
use std::cell::RefCell;

// 定义符号变量
assign_symbols!(_X_: VectorVar3);
assign_symbols!(_Y_: SE2);
assign_symbols!(_Z_: SE3);

// 相机内参
const FX: f64 = 718.856;
const FY: f64 = 718.856;
const CX: f64 = 607.1928;
const CY: f64 = 185.2157;
// 基线
const BASELINE: f64 = 0.573;

// 双线性插值
fn get_pixel_value(img: &ImageBuffer&LTLuma&LTu8>, Vec&LTu8>>, x: f64, y: f64) -> f64 {
    let mut x = x;
    let mut y = y;
    
    // 边界检查
    if x < 0.0 {
        x = 0.0;
    }
    if y < 0.0 {
        y = 0.0;
    }
    if x >= img.width() as f64 - 1.0 {
        x = img.width() as f64 - 1.0;
    }
    if y >= img.height() as f64 - 1.0 {
        y = img.height() as f64 - 1.0;
    }

    let x_floor = x.floor() as u32;
    let y_floor = y.floor() as u32;
    let xx = x - x_floor as f64;
    let yy = y - y_floor as f64;

    // 确保不越界
    let x_ceil = (x_floor + 1).min(img.width() - 1);
    let y_ceil = (y_floor + 1).min(img.height() - 1);

    let data = |x: u32, y: u32| img.get_pixel(x, y)[0] as f64;

    (1.0 - xx) * (1.0 - yy) * data(x_floor, y_floor) +
    xx * (1.0 - yy) * data(x_ceil, y_floor) +
    (1.0 - xx) * yy * data(x_floor, y_ceil) +
    xx * yy * data(x_ceil, y_ceil)
}

// 用于并行累加雅可比矩阵的结构体
struct JacobianAccumulator<'a> {
    img1: &'a ImageBuffer&LTLuma&LTu8>, Vec&LTu8>>,
    img2: &'a ImageBuffer&LTLuma&LTu8>, Vec&LTu8>>,
    px_ref: &'a Vec&LTVector2&LTf64>>,
    depth_ref: &'a Vec&LTf64>,
    T21: &'a mut SE3&LTf64>,
    projection: Vec&LTVector2&LTf64>>,
    H: Matrix6&LTf64>,
    b: Vector6&LTf64>,
    cost: f64,
}

impl<'a> JacobianAccumulator<'a> {
    fn new(
        img1: &'a ImageBuffer&LTLuma&LTu8>, Vec&LTu8>>,
        img2: &'a ImageBuffer&LTLuma&LTu8>, Vec&LTu8>>,
        px_ref: &'a Vec&LTVector2&LTf64>>,
        depth_ref: &'a Vec&LTf64>,
        T21: &'a mut SE3&LTf64>
    ) -> Self {
        let projection = vec![Vector2::zeros(); px_ref.len()];
        Self {
            img1,
            img2,
            px_ref,
            depth_ref,
            T21,
            projection,
            H: Matrix6::zeros(),
            b: Vector6::zeros(),
            cost: 0.0,
        }
    }

    fn accumulate_jacobian(&mut self, range: std::ops::Range&LTusize>) {
        let half_patch_size = 1;  
        let mut cnt_good = 0;
        let mut hessian = Matrix6::zeros();
        let mut bias = Vector6::zeros();
        let mut cost_tmp = 0.0;

        for i in range {
            // 计算在第二张图像中的投影
            let point_ref = self.depth_ref[i] * Vector3::new(
                (self.px_ref[i].x - CX) / FX,
                (self.px_ref[i].y - CY) / FY,
                1.0
            );
            let point_cur = self.T21.apply(point_ref.as_view());
            if point_cur[2] < 0.0 {   // 深度无效
                continue;
            }

            let u = FX * point_cur[0] / point_cur[2] + CX;
            let v = FY * point_cur[1] / point_cur[2] + CY;
            if u < half_patch_size as f64 || u > (self.img2.width() - half_patch_size) as f64 ||
                v < half_patch_size as f64 || v > (self.img2.height() - half_patch_size) as f64 {
                continue;
            }

            self.projection[i] = Vector2::new(u, v);
            let X = point_cur[0];
            let Y = point_cur[1];
            let Z = point_cur[2];
            let Z2 = Z * Z;
            let Z_inv = 1.0 / Z;
            let Z2_inv = Z_inv * Z_inv;
            cnt_good += 1;

            // 计算误差和雅可比
            for x in -(half_patch_size as i32)..=half_patch_size as i32 {
                for y in -(half_patch_size as i32)..=half_patch_size as i32 {
                    let error = get_pixel_value(self.img1, self.px_ref[i].x + x as f64, self.px_ref[i].y + y as f64) -
                                get_pixel_value(self.img2, u + x as f64, v + y as f64);
                    let mut J_pixel_xi = Matrix2x6::zeros();
                    let mut J_img_pixel = Vector2::zeros();

                    J_pixel_xi[(0, 0)] = FX * Z_inv;
                    J_pixel_xi[(0, 1)] = 0.0;
                    J_pixel_xi[(0, 2)] = -FX * X * Z2_inv;
                    J_pixel_xi[(0, 3)] = -FX * X * Y * Z2_inv;
                    J_pixel_xi[(0, 4)] = FX + FX * X * X * Z2_inv;
                    J_pixel_xi[(0, 5)] = -FX * Y * Z_inv;

                    J_pixel_xi[(1, 0)] = 0.0;
                    J_pixel_xi[(1, 1)] = FY * Z_inv;
                    J_pixel_xi[(1, 2)] = -FY * Y * Z2_inv;
                    J_pixel_xi[(1, 3)] = -FY - FY * Y * Y * Z2_inv;
                    J_pixel_xi[(1, 4)] = FY * X * Y * Z2_inv;
                    J_pixel_xi[(1, 5)] = FY * X * Z_inv;

                    J_img_pixel = Vector2::new(
                        0.5 * (get_pixel_value(self.img2, u + 1.0 + x as f64, v + y as f64) - get_pixel_value(self.img2, u - 1.0 + x as f64, v + y as f64)),
                        0.5 * (get_pixel_value(self.img2, u + x as f64, v + 1.0 + y as f64) - get_pixel_value(self.img2, u + x as f64, v - 1.0 + y as f64))
                    );

                    // 总雅可比
                    let J = -1.0 * (J_img_pixel.transpose() * J_pixel_xi).transpose();

                    hessian += J * J.transpose();
                    bias += -error * J;
                    cost_tmp += error * error;
                }
            }
        }

        if cnt_good > 0 {
            self.H += hessian;
            self.b += bias;
            self.cost += cost_tmp / cnt_good as f64;
        }
    }

    fn hessian(&self) -> Matrix6&LTf64> {
        self.H
    }

    fn bias(&self) -> Vector6&LTf64> {
        self.b
    }

    fn cost_func(&self) -> f64 {
        self.cost
    }

    fn projected_points(&self) -> &Vec&LTVector2&LTf64>> {
        &self.projection
    }

    fn reset(&mut self) {
        self.H = Matrix6::zeros();
        self.b = Vector6::zeros();
        self.cost = 0.0;
    }
}

fn direct_pose_estimation_single_layer(
    img1: &ImageBuffer&LTLuma&LTu8>, Vec&LTu8>>,
    img2: &ImageBuffer&LTLuma&LTu8>, Vec&LTu8>>,
    px_ref: &Vec&LTVector2&LTf64>>,
    depth_ref: &Vec&LTf64>,
    T21: &mut SE3&LTf64>
) {
    let iterations = 10;
    let mut cost = 0.0;
    let mut last_cost = 0.0;
    let t1 = Instant::now();

    for iter in 0..iterations {
        // 使用 T21 的克隆来避免借用冲突
        let mut T21_clone = T21.clone();
        let mut jaco_accu = JacobianAccumulator::new(img1, img2, px_ref, depth_ref, &mut T21_clone);
        jaco_accu.reset();
        jaco_accu.accumulate_jacobian(0..px_ref.len());
        let H = jaco_accu.hessian();
        let b = jaco_accu.bias();

        // 求解更新并放入估计
        let update = H.lu().solve(&b).unwrap_or_else(|| {
            eprintln!("矩阵求解失败!");
            Vector6::zeros()
        });
        if update[0].is_nan() {
            // 有时发生在我们有一个黑色或白色的补丁并且H是不可逆的
            eprintln!("更新为nan");
            break;
        }

        // 更新 T21
        *T21 = SE3::exp((&update).into()) * T21.clone();
        cost = jaco_accu.cost_func();

        if iter > 0 && cost > last_cost {
            eprintln!("成本增加: {}, {}", cost, last_cost);
            break;
        }
        if update.norm() < 1e-3 {
            // 收敛
            break;
        }

        last_cost = cost;
        println!("迭代: {}, 成本: {}", iter, cost);
    }

    println!("T21 = \n{}", T21.to_matrix());
    let t2 = Instant::now();
    let time_used = t2.duration_since(t1).as_secs_f64();
    println!("单层直接法: {}", time_used);

    // 在此处绘制投影像素,转换为rgb图
    let mut img2_show: RgbImage = img2.convert();

    let mut T21_clone = T21.clone();
    let mut jaco_accu = JacobianAccumulator::new(img1, img2, px_ref, depth_ref, &mut T21_clone);
    let projection = jaco_accu.projected_points();
    for i in 0..px_ref.len() {
        let p_ref = px_ref[i];
        let p_cur = projection[i];
        if p_cur.x > 0.0 && p_cur.y > 0.0 {
            draw_cross_mut(&mut img2_show, Rgb([0, 250, 0]), p_cur.x as i32, p_cur.y as i32);
            draw_line_segment_mut(&mut img2_show, (p_ref.x as f32, p_ref.y as f32), (p_cur.x as f32, p_cur.y as f32), Rgb([0, 250, 0]));
        }
    }
    img2_show.save("ch8-direct_method-current.png").unwrap();
}

// 多层直接法位姿估计
fn direct_pose_estimation_multi_layer(
    img1: &ImageBuffer&LTLuma&LTu8>, Vec&LTu8>>,
    img2: &ImageBuffer&LTLuma&LTu8>, Vec&LTu8>>,
    px_ref: &Vec&LTVector2&LTf64>>,
    depth_ref: &Vec&LTf64>,
    T21: &mut SE3&LTf64>
) {
    // 参数
    let pyramids = 4;
    let pyramid_scale = 0.5;
    let scales = [1.0, 0.5, 0.25, 0.125];

    // 创建金字塔
    let mut pyr1 = Vec::new();
    let mut pyr2 = Vec::new();
    for i in 0..pyramids {
        if i == 0 {
            pyr1.push(img1.clone());
            pyr2.push(img2.clone());
        } else {
            let img1_pyr = image::imageops::resize(&pyr1[i - 1], (pyr1[i - 1].width() as f64 * pyramid_scale) as u32, (pyr1[i - 1].height() as f64 * pyramid_scale) as u32, image::imageops::FilterType::Nearest);
            let img2_pyr = image::imageops::resize(&pyr2[i - 1], (pyr2[i - 1].width() as f64 * pyramid_scale) as u32, (pyr2[i - 1].height() as f64 * pyramid_scale) as u32, image::imageops::FilterType::Nearest);

            // 转换图片为灰度图,直接将luma8数据推入向量
            pyr1.push(img1_pyr);
            pyr2.push(img2_pyr);
        }
    }

    let fxG = FX;
    let fyG = FY;
    let cxG = CX;
    let cyG = CY;  // 备份旧值
    for level in (0..pyramids).rev() {
        let mut px_ref_pyr = Vec::new();
        for px in px_ref {
            px_ref_pyr.push(scales[level] * px);
        }

        // 在不同的金字塔层次中缩放 fx, fy, cx, cy
        let fx = fxG * scales[level];
        let fy = fyG * scales[level];
        let cx = cxG * scales[level];
        let cy = cyG * scales[level];
        direct_pose_estimation_single_layer(&pyr1[level], &pyr2[level], &px_ref_pyr, depth_ref, T21);
    }
}

fn main() {
    let left_file = "./assets/ch8-left.png";
    let disparity_file = "./assets/ch8-disparity.png";
    let fmt_others = "./assets/ch8-{:06}.png"; // 注意这里是 {:06}，不是 %06d

    let left_img = open(left_file).unwrap().to_luma8();
    let disparity_img = open(disparity_file).unwrap().to_luma8();

    // 我们在第一张图像中随机选择像素并在第一张图像的帧中生成一些3D点
    let mut rng = rand::thread_rng();
    let nPoints = 2000;
    let boarder = 20;
    let mut pixels_ref = Vec::new();
    let mut depth_ref = Vec::new();

    // 在ref中生成像素并加载深度数据
    for _ in 0..nPoints {
        let x = rng.gen_range(boarder..left_img.width() - boarder) as f64;
        let y = rng.gen_range(boarder..left_img.height() - boarder) as f64;
        let disparity = disparity_img.get_pixel(x as u32, y as u32)[0] as f64;
        let depth = FX * BASELINE / disparity; // 你知道这是视差到深度
        depth_ref.push(depth);
        pixels_ref.push(Vector2::new(x, y));
    } // 结束for

    // 使用此信息估计01~05.png的姿态
    let mut T_cur_ref = SE3::identity();

    for i in 1..6 {
        let img_path = format!("./assets/ch8-{:06}.png", i);
        println!("图片路径:{:?}\n",img_path);
        let img = open(&img_path).unwrap().to_luma8();
        direct_pose_estimation_multi_layer(&left_img, &img, &pixels_ref, &depth_ref, &mut T_cur_ref);
    }

}
</code></pre><h3 id=dai-ma-luo-ji-fen-xi>代码逻辑分析</h3><ol><li><p><strong>相机内参和基线</strong>：代码中定义了相机的内参（<code>fx</code>, <code>fy</code>, <code>cx</code>, <code>cy</code>）和基线（<code>baseline</code>），这些参数用于将视差转换为深度。</p><li><p><strong>图像读取</strong>：代码读取了左图和视差图，并随机选择了一些像素点用于后续的位姿估计。</p><li><p><strong>深度计算</strong>：通过视差图计算深度信息，并将其存储在<code>depth_ref</code>中。</p><li><p><strong>位姿估计</strong>：使用直接法进行位姿估计，分为单层和多层两种方法。代码中调用的是多层方法<code>DirectPoseEstimationMultiLayer</code>。</p><li><p><strong>雅可比累加器</strong>：<code>JacobianAccumulator</code>类用于在多线程环境下累加雅可比矩阵和计算误差。</p><li><p><strong>双线性插值</strong>：<code>GetPixelValue</code>函数用于在图像中进行双线性插值，确保在浮点坐标下获取像素值。</p></ol><h3 id=xiao-guo>效果</h3><ol><li>输出</ol><pre class=language-sh data-lang=sh><code class=language-sh data-lang=sh>图片路径:"./assets/ch8-000001.png"

迭代: 0, 成本: 12308.606882324208
T21 = 

  ┌                                                                                             ┐
  │     0.9524303857277323     0.3015001816619056   0.044429728790090155  -0.003210241232723807 │
  │   -0.28373242767373474     0.9304624727537855   -0.23180918075710438 -0.0007448658012033818 │
  │   -0.11123070542297181    0.20817595263322064      0.971746110317072   0.004654729361295467 │
  │                      0                      0                      0                      1 │
  └                                                                                             ┘


单层直接法: 0.265253083
迭代: 0, 成本: 85669.981282861
T21 = 

  ┌                                                                                             ┐
  │     0.9218799427483955     0.3859353122197975    0.03451530008594093  -0.005209022743755008 │
  │    -0.3607089083126468     0.8873181597241661    -0.2873248455800819 -0.0008377164815452974 │
  │    -0.1415148565420385    0.25242903597947436     0.9572111194362295  0.0075372648611578925 │
  │                      0                      0                      0                      1 │
  └                                                                                             ┘


单层直接法: 0.209044375
迭代: 0, 成本: 86278.86385506127
迭代: 1, 成本: 78932.01005537802
T21 = 

  ┌                                                                                             ┐
  │     0.9125446387532822    0.40829198571115227   0.023662981356667577  -0.003920845296385371 │
  │    -0.3842899544360964     0.8758218816839785   -0.29198846292796965 -0.0005550692441357431 │
  │   -0.13994110619165737     0.2573590603953543      0.956129071219088   0.005821003343790509 │
  │                      0                      0                      0                      1 │
  └                                                                                             ┘


单层直接法: 0.218726375
迭代: 0, 成本: 80969.97454752732
T21 = 

  ┌                                                                                             ┐
  │     0.9024751333468863     0.4303302061971928   0.018829427097003137 -0.0038350987692527313 │
  │    -0.4083426816880122     0.8686402069107689   -0.28057164013823516  0.0009773860335536846 │
  │   -0.13709444920332334    0.24552006959166922       0.95964837697218   0.006101092525896705 │
  │                      0                      0                      0                      1 │
  └                                                                                             ┘


单层直接法: 0.127039291
图片路径:"./assets/ch8-000002.png"

迭代: 0, 成本: 62918.87454601741
迭代: 1, 成本: 50964.083456400964
T21 = 

  ┌                                                                                         ┐
  │    0.9471695479166553  -0.29475511826277095  -0.12644867637606494 -0.024437567736266715 │
  │   0.31573559637889087    0.9262155288055071    0.2059995810160813 -0.006922309367973688 │
  │   0.05639929679193713  -0.23504087826894032    0.9703478267425244  0.031340398699299214 │
  │                     0                     0                     0                     1 │
  └                                                                                         ┘


单层直接法: 0.200831125
迭代: 0, 成本: 69534.8098484062
T21 = 

  ┌                                                                                         ┐
  │    0.9472662867926415  -0.29811538115257286  -0.11753212933635326  -0.02048814529041247 │
  │   0.31717620385681067    0.9245284812892887     0.211296812545538 -0.005842805353928968 │
  │   0.04567097122969815  -0.23743274164524486    0.9703297664102439  0.026951156449003068 │
  │                     0                     0                     0                     1 │
  └                                                                                         ┘


单层直接法: 0.184161042
迭代: 0, 成本: 83774.72875510731
T21 = 

  ┌                                                                                         ┐
  │    0.9471687899339618  -0.29351554196707935  -0.12930549098474545 -0.021599883894582617 │
  │   0.31590017516818664    0.9234576352579759    0.2177913570655551 -0.005447138203677023 │
  │   0.05548299472580243   -0.2471328033821467    0.9673918620645605  0.026764523956617322 │
  │                     0                     0                     0                     1 │
  └                                                                                         ┘


单层直接法: 0.1588415
迭代: 0, 成本: 95209.12401528576
T21 = 

  ┌                                                                                             ┐
  │     0.9333317952635999   -0.31511300687588656   -0.17203358058141766  -0.023745940533225245 │
  │     0.3542740917013179      0.885997942912672    0.29916134961542046 -0.0009776576916912668 │
  │   0.058151766088673965   -0.34016384001264904     0.9385664249527665   0.026241319858266894 │
  │                      0                      0                      0                      1 │
  └                                                                                             ┘


单层直接法: 0.126065416
图片路径:"./assets/ch8-000003.png"

迭代: 0, 成本: 22775.232856931147
T21 = 

  ┌                                                                                         ┐
  │   0.04421799171614049    0.8267708019552389   -0.5607983686164595  -0.11494996211886517 │
  │   -0.5883617834340118   -0.4321172771721953   -0.6834508545342795 -0.013060132923383315 │
  │   -0.8073878751894532    0.3601731525302503    0.4673329853471514   0.17026336457658037 │
  │                     0                     0                     0                     1 │
  └                                                                                         ┘


单层直接法: 0.014470583
迭代: 0, 成本: 63921.11568575347
T21 = 

  ┌                                                                                         ┐
  │  -0.04616616846798771    0.7583799406344983   -0.6501757843323606  -0.12865335429683258 │
  │  -0.49587978081956463   -0.5824112758412814   -0.6441275873204559 -0.018972255722675038 │
  │   -0.8671631495072458   0.29267212271780474   0.40295297581793377    0.1871745873124643 │
  │                     0                     0                     0                     1 │
  └                                                                                         ┘


单层直接法: 0.102599416
迭代: 0, 成本: 130972.77167231684
T21 = 

  ┌                                                                                         ┐
  │  -0.07708204146335573    0.7174503164073005    -0.692331858555495  -0.12220712057420292 │
  │   -0.4823637720411582   -0.6345562962860871   -0.6038737436467237 -0.009325333785477431 │
  │   -0.8725729484152411    0.2874079858506856    0.3949849356155055   0.17640532201758752 │
  │                     0                     0                     0                     1 │
  └                                                                                         ┘


单层直接法: 0.056263917
迭代: 0, 成本: 160315.8221080921
迭代: 1, 成本: 117803.74896521952
T21 = 

  ┌                                                                                     ┐
  │  0.11041063796222783   0.8092234858483349  -0.5770327902088784 -0.12796900323951144 │
  │  -0.6937522281289734 -0.35299298414217173  -0.6277768704822513 0.012703735880665796 │
  │  -0.7117003140303219   0.4696310286787641   0.5224264157862495   0.1615720204177094 │
  │                    0                    0                    0                    1 │
  └                                                                                     ┘


单层直接法: 0.04936275
图片路径:"./assets/ch8-000004.png"

T21 = 

  ┌                                                                                     ┐
  │  0.11041063796222783   0.8092234858483349  -0.5770327902088784 -0.12796900323951144 │
  │  -0.6937522281289734 -0.35299298414217173  -0.6277768704822513 0.012703735880665796 │
  │  -0.7117003140303219   0.4696310286787641   0.5224264157862495   0.1615720204177094 │
  │                    0                    0                    0                    1 │
  └                                                                                     ┘


单层直接法: 0.002474291
迭代: 0, 成本: 9952.64361905522
T21 = 

  ┌                                                                                     ┐
  │   0.9936933376281276  0.10127337313948065   0.0481378712286223  -0.0973772597095485 │
  │  -0.0881181514129811   0.9707573545011597 -0.22330550838138477 -0.06053442151615137 │
  │ -0.06934509459962428  0.21765537570862173   0.9735591380497169  0.12565698167218953 │
  │                    0                    0                    0                    1 │
  └                                                                                     ┘


单层直接法: 0.006331209
迭代: 0, 成本: 63264.225409655686
T21 = 

  ┌                                                                                         ┐
  │     0.993265544467401   0.09742560583615734   0.06270414261701729  -0.09536557330216772 │
  │   -0.0810970355733821    0.9711440954988444    -0.224282002396405 -0.062349676699279086 │
  │  -0.08274556782745005    0.2176864651400935    0.9725048965942145    0.1302758082903449 │
  │                     0                     0                     0                     1 │
  └                                                                                         ┘


单层直接法: 0.072367167
迭代: 0, 成本: 119395.80207527199
T21 = 

  ┌                                                                                     ┐
  │   0.9902854758169111  0.12098584779861912  0.06853539974730932  -0.0944911844223315 │
  │ -0.10422445060874833   0.9721083356759842 -0.21010151737808208 -0.05673084026913784 │
  │ -0.09204314358700871  0.20091741672069474   0.9752744492587222  0.13244235645914174 │
  │                    0                    0                    0                    1 │
  └                                                                                     ┘


单层直接法: 0.176934625
图片路径:"./assets/ch8-000005.png"

T21 = 

  ┌                                                                                     ┐
  │   0.9902854758169111  0.12098584779861912  0.06853539974730932  -0.0944911844223315 │
  │ -0.10422445060874833   0.9721083356759842 -0.21010151737808208 -0.05673084026913784 │
  │ -0.09204314358700871  0.20091741672069474   0.9752744492587222  0.13244235645914174 │
  │                    0                    0                    0                    1 │
  └                                                                                     ┘


单层直接法: 0.002497459
迭代: 0, 成本: 51340.046356081984
T21 = 

  ┌                                                                                     ┐
  │    0.488721427927844  0.01590160068119037  -0.8722949644357377 -0.24508797891778478 │
  │   0.3281547532426462  -0.9297616528746497  0.16690634130570506  0.05602332984185457 │
  │  -0.8083723299374038 -0.36781844426234866  -0.4596126284731503 0.009371172503020716 │
  │                    0                    0                    0                    1 │
  └                                                                                     ┘


单层直接法: 0.005589166
T21 = 

  ┌                                                                                     ┐
  │    0.488721427927844  0.01590160068119037  -0.8722949644357377 -0.24508797891778478 │
  │   0.3281547532426462  -0.9297616528746497  0.16690634130570506  0.05602332984185457 │
  │  -0.8083723299374038 -0.36781844426234866  -0.4596126284731503 0.009371172503020716 │
  │                    0                    0                    0                    1 │
  └                                                                                     ┘


单层直接法: 0.002532792
T21 = 

  ┌                                                                                     ┐
  │    0.488721427927844  0.01590160068119037  -0.8722949644357377 -0.24508797891778478 │
  │   0.3281547532426462  -0.9297616528746497  0.16690634130570506  0.05602332984185457 │
  │  -0.8083723299374038 -0.36781844426234866  -0.4596126284731503 0.009371172503020716 │
  │                    0                    0                    0                    1 │
  └                                                                                     ┘


单层直接法: 0.0024075

成本增加: 56793.99123379931, 12308.606882324208
成本增加: 92649.7299219401, 85669.981282861
成本增加: 80753.76146512033, 78932.01005537802
成本增加: 81108.55695446623, 80969.97454752732
成本增加: 76023.83826864949, 50964.083456400964
成本增加: 76052.18150445452, 69534.8098484062
成本增加: 88042.76661683866, 83774.72875510731
成本增加: 108168.18679485178, 95209.12401528576
成本增加: 132775.2488141031, 22775.232856931147
成本增加: 68884.44033429243, 63921.11568575347
成本增加: 146982.56562344934, 130972.77167231684
成本增加: 136980.53080711715, 117803.74896521952
矩阵求解失败!
矩阵求解失败!
成本增加: 71608.36972602786, 63264.225409655686
成本增加: 120213.22098266528, 119395.80207527199
矩阵求解失败!
矩阵求解失败!
矩阵求解失败!
矩阵求解失败!
</code></pre><ol start=2><li>图片比较</ol><table><thead><tr><th>ch8-direct_method-current<th>ch8-disparity<tbody><tr><td><img alt decoding=async loading=lazy src=https://img2024.cnblogs.com/blog/1048201/202501/1048201-20250123123525862-548337074.png><td><img alt decoding=async loading=lazy src=https://img2024.cnblogs.com/blog/1048201/202501/1048201-20250123123530252-1402606991.png><tr><td>000001<td>000002<tr><td><img alt decoding=async loading=lazy src=https://img2024.cnblogs.com/blog/1048201/202501/1048201-20250123123536351-2124919815.png><td><img alt decoding=async loading=lazy src=https://img2024.cnblogs.com/blog/1048201/202501/1048201-20250123123540375-1139636499.png><tr><td>000003<td>000004<tr><td><img alt decoding=async loading=lazy src=https://img2024.cnblogs.com/blog/1048201/202501/1048201-20250123123543564-565289117.png><td><img alt decoding=async loading=lazy src=https://img2024.cnblogs.com/blog/1048201/202501/1048201-20250123123546970-470310915.png><tr><td>000005<td><tr><td><img alt decoding=async loading=lazy src=https://img2024.cnblogs.com/blog/1048201/202501/1048201-20250123123551774-423709835.png><td></table><h3>分析</h3><ol><li><p><strong>迭代过程</strong>：输出显示了每次迭代的成本（cost），以及最终的位姿矩阵（T21）。成本的变化反映了优化过程的收敛情况。</p><li><p><strong>成本增加</strong>：在某些迭代中，成本出现了增加的情况，这可能是由于优化过程中的局部极小值或数值不稳定性导致的。</p><li><p><strong>矩阵求解失败</strong>：在某些情况下，输出显示“矩阵求解失败”，这通常是由于雅可比矩阵的条件数较差，导致线性方程组不可解。</p></ol></article><div><div class=post-copyright><div class=post-copyright__author_group><a class=post-copyright__author_img href=/about> <picture class="post-copyright__author_img_back progressive-picture"><img class=progressive-thumbnail decoding=async loading=lazy src=/processed_images/avatar.d5facb578cf12fdc.webp><source media="(min-width: 1em)" srcset=/processed_images/avatar.8bb6bf05eac51207.avif><img class=progressive-content decoding=async loading=lazy onload=progressiveLoad(this) src=/processed_images/avatar.06a48b3b45482d6b.webp><noscript><img decoding=async loading=lazy src=/processed_images/avatar.06a48b3b45482d6b.webp></noscript></picture> </a><div class=post-copyright__author_name>ByeIO·开发者博客</div><div class=post-copyright__author_desc>ByeIO·开发者博客|技术解决方案|开发思考|总结</div></div><div class=post-tools id=post-tools><div class=post-tools-left><div class=rewardLeftButton><div class="reward-link mode"><a class=reward-link-button href=/subscribe> <i class=icon-plant-fill></i>订阅 </a></div></div><div class=shareRight><div class="copyright-link mobile"><div class=copyright-qrcode><div class=copyright-button title=使用手机访问这篇文章><i class=icon-qrcode></i></div><div class=copyright-main><div class=copyright-main-all><div id=qrcode></div><div class=reward-dec>使用手机访问这篇文章</div></div></div></div></div><div class="copyright-link copyurl"><div class=copyright-button id=post-share-url onclick=rm.copyPageUrl() title=复制链接><i class=icon-link></i></div></div></div></div></div><div class=post-copyright__notice><span class=post-copyright-info> 本文是原创文章，采用 <a href=/copyright target=_blank>CC BY-NC-ND 4.0</a> 协议，转载请注明 <a href=/ target=_blank>本站名称及地址</a> </span></div></div><div class=post-tools-right><div class=tag_share><div class=post-meta__tag-list><a class=post-meta__tags href=/tags/blog/> <span class=tags-punctuation>博客</span> <span class=tagsPageCount>31</span> </a><a class=post-meta__tags href=/tags/docs/> <span class=tags-punctuation>文档</span> <span class=tagsPageCount>25</span> </a><a class=post-meta__tags href=/tags/featured/> <span class=tags-punctuation>必看</span> <span class=tagsPageCount>30</span> </a><a class=post-meta__tags href=/tags/hot/> <span class=tags-punctuation>热门</span> <span class=tagsPageCount>30</span> </a></div></div></div><link href=/css/post-copyright-one.css rel=stylesheet></div><nav class="pagination-post needEndHide" id=pagination><div class="prev-post pull-left"><a href=/articles/docs/折腾笔记[10]-使用rust进行ORB角点检测/> <div class=pagination-info><div class=label>上一篇</div><div class=prev_info>折腾笔记[10]-使用rust进行ORB角点检测</div></div> </a></div><div class="next-post pull-right"><a href=/articles/docs/折腾笔记[12]-使用rust进行位姿图优化/> <div class=pagination-info><div class=label>下一篇</div><div class=next_info>折腾笔记[12]-使用rust进行位姿图优化</div></div> </a></div></nav><div class=relatedPosts><div class=headline><i class=icon-cainixihuan style=font-size:1.1rem></i><span>喜欢这篇文章的人也看了</span></div><div class=relatedPosts-list><div><a href=/articles/docs/ROS笔记[1]-搭建Gazebo仿真环境/ title=ROS笔记[1]-搭建Gazebo仿真环境> <picture class="cover progressive-picture"><img class=progressive-thumbnail decoding=async loading=lazy src=/processed_images/img00006.8f57f1d144c2cfd7.webp><source media="(min-width: 75em)" srcset="/processed_images/img00006.688adcb5ebd82ad6.avif?w=75em"><source media="(min-width: 60em)" srcset="/processed_images/img00006.8e3bcf4e0c9fd77c.avif?w=60em"><source media="(min-width: 45em)" srcset="/processed_images/img00006.08513801052a4920.avif?w=45em"><source media="(min-width: 30em)" srcset="/processed_images/img00006.0928215d8428e769.avif?w=30em"><source media="(min-width: 22em)" srcset="/processed_images/img00006.c83fffe523ead88b.avif?w=22em"><img src="/processed_images/img00006.1e5d356251b272fe.webp?w=30em" srcset="/processed_images/img00006.0beae348737c79a0.webp?w=22em 360w,
              /processed_images/img00006.1e5d356251b272fe.webp?w=30em 500w,
              /processed_images/img00006.c010a791dd57f875.webp?w=45em 720w,
              /processed_images/img00006.86f2248bcd34f02f.webp?w=60em 960w,
              /processed_images/img00006.799278f602588342.webp?w=75em 1200w" class=progressive-content decoding=async loading=lazy onload=progressiveLoad(this)><noscript><img src="/processed_images/img00006.1e5d356251b272fe.webp?w=30em" decoding=async loading=lazy></noscript></picture> <div class="content is-center"><div class=date><i class="far fa-calendar-alt fa-fw"></i> 2025-01-01</div><div class=title>ROS笔记[1]-搭建Gazebo仿真环境</div></div> </a></div><div><a href=/articles/docs/ROS笔记[2]-获取OpenMV数据并发布到ROS消息/ title=ROS笔记[2]-获取OpenMV数据并发布到ROS消息> <picture class="cover progressive-picture"><img class=progressive-thumbnail decoding=async loading=lazy src=/processed_images/img00006.8f57f1d144c2cfd7.webp><source media="(min-width: 75em)" srcset="/processed_images/img00006.688adcb5ebd82ad6.avif?w=75em"><source media="(min-width: 60em)" srcset="/processed_images/img00006.8e3bcf4e0c9fd77c.avif?w=60em"><source media="(min-width: 45em)" srcset="/processed_images/img00006.08513801052a4920.avif?w=45em"><source media="(min-width: 30em)" srcset="/processed_images/img00006.0928215d8428e769.avif?w=30em"><source media="(min-width: 22em)" srcset="/processed_images/img00006.c83fffe523ead88b.avif?w=22em"><img src="/processed_images/img00006.1e5d356251b272fe.webp?w=30em" srcset="/processed_images/img00006.0beae348737c79a0.webp?w=22em 360w,
              /processed_images/img00006.1e5d356251b272fe.webp?w=30em 500w,
              /processed_images/img00006.c010a791dd57f875.webp?w=45em 720w,
              /processed_images/img00006.86f2248bcd34f02f.webp?w=60em 960w,
              /processed_images/img00006.799278f602588342.webp?w=75em 1200w" class=progressive-content decoding=async loading=lazy onload=progressiveLoad(this)><noscript><img src="/processed_images/img00006.1e5d356251b272fe.webp?w=30em" decoding=async loading=lazy></noscript></picture> <div class="content is-center"><div class=date><i class="far fa-calendar-alt fa-fw"></i> 2025-01-01</div><div class=title>ROS笔记[2]-获取OpenMV数据并发布到ROS消息</div></div> </a></div></div></div><link href=/css/related-posts-two.css rel=stylesheet><hr></div><div class=aside-content id=aside-content><div class="card-widget card-info"><div class=card-content><div class="card-info-avatar is-center"><div class=author-info__top-group><div class=author-info__sayhi id=author-info__sayhi onclick=wjx.changeSayHelloText()>好久不见，你终于来了</div></div></div><div class=avatar-img-group><picture class="avatar-img progressive-picture"><img class=progressive-thumbnail decoding=async loading=lazy src=/processed_images/avatar.d5facb578cf12fdc.webp><source media="(min-width: 1em)" srcset=/processed_images/avatar.8bb6bf05eac51207.avif><img class=progressive-content decoding=async loading=lazy onload=progressiveLoad(this) src=/processed_images/avatar.06a48b3b45482d6b.webp><noscript><img decoding=async loading=lazy src=/processed_images/avatar.06a48b3b45482d6b.webp></noscript></picture></div><div class=author-info__description_group>为创造者而生的开源 Zola 主题~</div><div class=author-info__bottom-group><a class=author-info__bottom-group-left href=/about> <div class=author-info__name>qsbye</div> <div class=author-info__desc>ByeIO·开发者博客|技术解决方案|开发思考|总结</div> </a><div class="card-info-social-icons is-center"><a rel="external nofollow" class=social-icon href=https://github.com/iWangJiaxiang/zola-theme-jiaxiang.wang target=_blank title=GitHub> <i class=icon-github></i> </a></div></div></div><style>.avatar-img-group:before{content:"";-o-transition:1s;background:var(--wjx-green);border:5px solid var(--wjx-background);z-index:2;border-radius:50%;width:26px;height:26px;-webkit-transition:all 1s;-moz-transition:all 1s;-ms-transition:all 1s;transition:all 1s;position:absolute;bottom:2px;right:2px}.card-info-avatar.is-center{flex-direction:column;align-items:flex-start;display:flex}#aside-content .card-info .avatar-img{opacity:1;border:5px solid var(--wjx-white);border-radius:500px;width:118px;transition:all .3s;position:absolute;top:0;right:0;overflow:hidden}.page #aside-content .card-info .avatar-img{border-color:var(--wjx-card-bg)}.author-info__top-group{width:100%;height:28px;display:flex}.avatar-img-group{transform-origin:bottom;border-radius:500px;width:118px;height:118px;transition:all .3s cubic-bezier(.69,.39,0,1.21);position:absolute;top:90px;right:calc(50% - 59px)}#aside-content .card-info:hover .avatar-img-group{opacity:0;transform:scale(0)}.author-info__bottom-group{justify-content:space-between;align-items:center;width:100%;padding:1.2rem;display:flex;position:absolute;bottom:0;left:0}a.author-info__bottom-group-left:hover{opacity:.8}#aside-content .card-info .card-info-social-icons{cursor:pointer;flex-flow:wrap;justify-content:flex-start;margin:0;display:flex}#aside-content .card-info .card-info-social-icons i:hover{cursor:pointer;background-color:#000;transform:rotate(540deg)}#aside-content .card-info .card-info-social-icons .social-icon{margin:0 0 0 8px}#aside-content .card-info .card-info-social-icons i{background:var(--wjx-white-op);color:var(--wjx-white);justify-content:center;align-items:center;width:40px;height:40px;font-size:1rem;display:flex}#aside-content .card-info .card-info-social-icons i:hover{background:var(--wjx-white);color:var(--wjx-main);box-shadow:none;transform:scale(1.1)}[data-theme=dark] .page #aside-content .card-info .card-info-social-icons i{background:var(--wjx-black-op);color:var(--wjx-card-bg)}[data-theme=dark] .page #aside-content .card-info .card-info-social-icons i:hover{background:var(--wjx-card-bg);color:var(--wjx-fontcolor)}#aside-content .card-info .banner-button{border-radius:20px;justify-content:center;width:118px;height:40px}@media screen and (width>=1300px){#aside-content .card-info .card-info-social-icons i{color:var(--wjx-white)}[data-theme=dark] .page #aside-content .card-info .card-info-social-icons i{color:var(--wjx-card-bg)}}#aside-content .card-info .card-info-data>.card-info-data-item:hover{background:var(--wjx-post-blockquote-bg);transform:scale(.97)}#aside-content>div.card-widget.card-info>div.card-content>div.card-info-data>.card-info-data-item:hover>a>div.headline,#aside-content>div.card-widget.card-info>div.card-content>div.card-info-data>.card-info-data-item:hover>a>div.length-num{color:var(--wjx-blue)}.author-info__description_group{color:var(--wjx-white);opacity:0;width:100%;padding:1.2rem;transition:all .3s;position:absolute;top:50px;left:0}.card-widget:hover .author-info__description_group{opacity:1}.author-info__description2{text-align:justify;z-index:2;color:#fffc;width:100%;margin:.3rem 0;line-height:1.38}.author-info__description2 b{color:var(--wjx-white)}[data-theme=dark] .page div#author-info__sayhi{background:var(--wjx-black-op);color:var(--wjx-black)}#aside-content .card-info .author-info__name{text-align:left;color:var(--wjx-white);margin-bottom:5px;font-size:20px;font-weight:700;line-height:1}.page #aside-content .card-info .author-info__name,.page .author-info__desc{color:var(--wjx-white)}.author-info__desc{color:var(--wjx-white);opacity:.6;font-size:12px;line-height:1}.author-info__description{text-align:justify;color:var(--wjx-white);opacity:1;margin:.3rem 0;line-height:1.38}.page .author-info__description{color:var(--wjx-card-bg)}.author-info__description b{color:var(--wjx-white);opacity:1}.page .author-info__description b{color:var(--wjx-card-bg);opacity:1}.avatar-sticker{z-index:0;background:var(--wjx-white);border-radius:50%;justify-content:center;align-items:center;width:33px;height:33px;line-height:34px;transition:all .3s ease-out .2s;display:flex;position:absolute;bottom:2px;right:2px;transform:scale(1)}.page .avatar-sticker{background:var(--wjx-card-bg)}.avatar-sticker img{width:26px;height:26px}.card-widget:hover .avatar-sticker{opacity:0;transform:scale(0)}.author-info__description b{color:var(--wjx-white)}#aside-content>.card-widget.card-info:before{background:linear-gradient(-25deg,var(--wjx-main),var(--wjx-main-op-deep),var(--wjx-main),var(--wjx-main-op-deep));content:"";background-size:400%;width:100%;height:100%;animation:15s infinite gradient;position:absolute;top:0;left:0}</style></div><div class="card-widget wjx-right-widget" onclick="javascript:window.open('/subscribe')" id=card-wechat><div id=flip-wrapper><div id=flip-content><div style="background:url(/img/wechat/qr-green.avif) 50%/100% no-repeat" class=face></div><div class="back face" style="background:url(/img/wechat/qr-white.avif) 50%/100% no-repeat"></div></div></div><style>#aside-content .card-widget#card-wechat{background:#07c160}#aside-content .card-widget#card-wechat:before{content:"";background:url(/img/wechat/gzh_cover.avif) 50%/cover no-repeat;width:100%;height:90%;transition:all .2s cubic-bezier(.45,.04,.43,1.21);position:absolute;top:0;left:0}#aside-content .card-widget#card-wechat:hover:before{opacity:0;transition:all .3s ease-out;top:100%}</style></div><div class=sticky_layout><div class=card-widget id=card-toc><div class=item-headline><i class=icon-bars></i><span>文章目录</span><span class=toc-percentage></span></div><div class=toc-content></div></div><div class="card-widget card-recent-post"><div class=item-headline><i class=icon-chat--fill style=font-size:19px></i><span>最新评论</span></div><div class=aside-list id=newcomm></div></div><div class="card-widget card-recent-post"><div class=item-headline><i class=icon-eicon_map-2-line1></i><span>最近发布</span></div><div class=aside-list><div class=aside-list-item><a class=thumbnail href=/articles/docs/配置orangepi5pro运行rknn版本的yolov5/ title=配置orangepi5pro运行rknn版本的yolov5> <picture class="post_bg progressive-picture"><img class=progressive-thumbnail decoding=async loading=lazy src=/processed_images/img00006.8f57f1d144c2cfd7.webp><source media="(min-width: 75em)" srcset="/processed_images/img00006.688adcb5ebd82ad6.avif?w=75em"><source media="(min-width: 60em)" srcset="/processed_images/img00006.8e3bcf4e0c9fd77c.avif?w=60em"><source media="(min-width: 45em)" srcset="/processed_images/img00006.08513801052a4920.avif?w=45em"><source media="(min-width: 30em)" srcset="/processed_images/img00006.0928215d8428e769.avif?w=30em"><source media="(min-width: 22em)" srcset="/processed_images/img00006.c83fffe523ead88b.avif?w=22em"><img src="/processed_images/img00006.1e5d356251b272fe.webp?w=30em" srcset="/processed_images/img00006.0beae348737c79a0.webp?w=22em 360w,
              /processed_images/img00006.1e5d356251b272fe.webp?w=30em 500w,
              /processed_images/img00006.c010a791dd57f875.webp?w=45em 720w,
              /processed_images/img00006.86f2248bcd34f02f.webp?w=60em 960w,
              /processed_images/img00006.799278f602588342.webp?w=75em 1200w" class=progressive-content decoding=async loading=lazy onload=progressiveLoad(this)><noscript><img src="/processed_images/img00006.1e5d356251b272fe.webp?w=30em" decoding=async loading=lazy></noscript></picture> </a><div class=content><a class=title href=/articles/docs/配置orangepi5pro运行rknn版本的yolov5/ title=配置orangepi5pro运行rknn版本的yolov5>配置orangepi5pro运行rknn版本的yolov5</a></div></div><div class=aside-list-item><a class=thumbnail href=/articles/docs/计算机控制apm飞控自动飞行/ title=计算机控制apm飞控自动飞行> <picture class="post_bg progressive-picture"><img class=progressive-thumbnail decoding=async loading=lazy src=/processed_images/img00006.8f57f1d144c2cfd7.webp><source media="(min-width: 75em)" srcset="/processed_images/img00006.688adcb5ebd82ad6.avif?w=75em"><source media="(min-width: 60em)" srcset="/processed_images/img00006.8e3bcf4e0c9fd77c.avif?w=60em"><source media="(min-width: 45em)" srcset="/processed_images/img00006.08513801052a4920.avif?w=45em"><source media="(min-width: 30em)" srcset="/processed_images/img00006.0928215d8428e769.avif?w=30em"><source media="(min-width: 22em)" srcset="/processed_images/img00006.c83fffe523ead88b.avif?w=22em"><img src="/processed_images/img00006.1e5d356251b272fe.webp?w=30em" srcset="/processed_images/img00006.0beae348737c79a0.webp?w=22em 360w,
              /processed_images/img00006.1e5d356251b272fe.webp?w=30em 500w,
              /processed_images/img00006.c010a791dd57f875.webp?w=45em 720w,
              /processed_images/img00006.86f2248bcd34f02f.webp?w=60em 960w,
              /processed_images/img00006.799278f602588342.webp?w=75em 1200w" class=progressive-content decoding=async loading=lazy onload=progressiveLoad(this)><noscript><img src="/processed_images/img00006.1e5d356251b272fe.webp?w=30em" decoding=async loading=lazy></noscript></picture> </a><div class=content><a class=title href=/articles/docs/计算机控制apm飞控自动飞行/ title=计算机控制apm飞控自动飞行>计算机控制apm飞控自动飞行</a></div></div><div class=aside-list-item><a href="/articles/docs/翻译[5]-基于rust和embassy异步框架的飞控固件_ Holsatus Flight/" title="翻译[5]-基于rust和embassy异步框架的飞控固件_ Holsatus Flight" class=thumbnail> <picture class="post_bg progressive-picture"><img class=progressive-thumbnail decoding=async loading=lazy src=/processed_images/img00006.8f57f1d144c2cfd7.webp><source media="(min-width: 75em)" srcset="/processed_images/img00006.688adcb5ebd82ad6.avif?w=75em"><source media="(min-width: 60em)" srcset="/processed_images/img00006.8e3bcf4e0c9fd77c.avif?w=60em"><source media="(min-width: 45em)" srcset="/processed_images/img00006.08513801052a4920.avif?w=45em"><source media="(min-width: 30em)" srcset="/processed_images/img00006.0928215d8428e769.avif?w=30em"><source media="(min-width: 22em)" srcset="/processed_images/img00006.c83fffe523ead88b.avif?w=22em"><img src="/processed_images/img00006.1e5d356251b272fe.webp?w=30em" srcset="/processed_images/img00006.0beae348737c79a0.webp?w=22em 360w,
              /processed_images/img00006.1e5d356251b272fe.webp?w=30em 500w,
              /processed_images/img00006.c010a791dd57f875.webp?w=45em 720w,
              /processed_images/img00006.86f2248bcd34f02f.webp?w=60em 960w,
              /processed_images/img00006.799278f602588342.webp?w=75em 1200w" class=progressive-content decoding=async loading=lazy onload=progressiveLoad(this)><noscript><img src="/processed_images/img00006.1e5d356251b272fe.webp?w=30em" decoding=async loading=lazy></noscript></picture> </a><div class=content><a href="/articles/docs/翻译[5]-基于rust和embassy异步框架的飞控固件_ Holsatus Flight/" title="翻译[5]-基于rust和embassy异步框架的飞控固件_ Holsatus Flight" class=title>翻译[5]-基于rust和embassy异步框架的飞控固件_ Holsatus Flight</a></div></div><div class=aside-list-item><a class=thumbnail href=/articles/docs/搭建ArduPilot的SITL仿真环境/ title=搭建ArduPilot的SITL仿真环境> <picture class="post_bg progressive-picture"><img class=progressive-thumbnail decoding=async loading=lazy src=/processed_images/img00006.8f57f1d144c2cfd7.webp><source media="(min-width: 75em)" srcset="/processed_images/img00006.688adcb5ebd82ad6.avif?w=75em"><source media="(min-width: 60em)" srcset="/processed_images/img00006.8e3bcf4e0c9fd77c.avif?w=60em"><source media="(min-width: 45em)" srcset="/processed_images/img00006.08513801052a4920.avif?w=45em"><source media="(min-width: 30em)" srcset="/processed_images/img00006.0928215d8428e769.avif?w=30em"><source media="(min-width: 22em)" srcset="/processed_images/img00006.c83fffe523ead88b.avif?w=22em"><img src="/processed_images/img00006.1e5d356251b272fe.webp?w=30em" srcset="/processed_images/img00006.0beae348737c79a0.webp?w=22em 360w,
              /processed_images/img00006.1e5d356251b272fe.webp?w=30em 500w,
              /processed_images/img00006.c010a791dd57f875.webp?w=45em 720w,
              /processed_images/img00006.86f2248bcd34f02f.webp?w=60em 960w,
              /processed_images/img00006.799278f602588342.webp?w=75em 1200w" class=progressive-content decoding=async loading=lazy onload=progressiveLoad(this)><noscript><img src="/processed_images/img00006.1e5d356251b272fe.webp?w=30em" decoding=async loading=lazy></noscript></picture> </a><div class=content><a class=title href=/articles/docs/搭建ArduPilot的SITL仿真环境/ title=搭建ArduPilot的SITL仿真环境>搭建ArduPilot的SITL仿真环境</a></div></div></div></div><div class="card-widget card-categories"><div class=item-headline><i class=icon-folder-open></i><span>分类</span></div><div class=aside-list><ul class=card-category-list><li class=card-category-list-item><a class=card-category-list-link href=/categories/misc/ rel=tag> <span class=card-category-list-name>杂谈</span> <span class=card-category-list-count>6</span> </a><li class=card-category-list-item><a class=card-category-list-link href=/categories/theme/ rel=tag> <span class=card-category-list-name>主题</span> <span class=card-category-list-count>25</span> </a></ul></div></div></div></div></main><footer id=footer><div id=wjx-footer-bar><div class=footer-logo>qsbye</div><div class=footer-bar-description>ByeIO·开发者博客|技术解决方案|开发思考|总结</div><a class=footer-bar-link href=/about>了解更多</a></div><div id=footer_deal><a rel="external nofollow noopener noreferrer" class=deal_link href=mailto:mail@example.com target=_blank title=Mail> <i class=icon-envelope></i> </a><picture class="footer_mini_logo progressive-picture" onclick="btf.scrollToDest(0, 500)" style=border-radius:500px><img class=progressive-thumbnail decoding=async loading=lazy src=/processed_images/avatar.d5facb578cf12fdc.webp><source media="(min-width: 1em)" srcset=/processed_images/avatar.8bb6bf05eac51207.avif><img alt=返回顶部 class=progressive-content decoding=async loading=lazy onload=progressiveLoad(this) src=/processed_images/avatar.06a48b3b45482d6b.webp><noscript><img alt=返回顶部 decoding=async loading=lazy src=/processed_images/avatar.06a48b3b45482d6b.webp></noscript></picture><a rel="external nofollow noopener noreferrer" class=deal_link href=https://github.com/iWangJiaxiang/zola-theme-jiaxiang.wang target=_blank title=Github> <i class=icon-github></i> </a></div><div id=wjx-footer><div class=footer-group><h3 class=footer-title>文库</h3><div class=footer-links><a class=footer-item data-pjax href=/archives target=_blank>全部文章</a><a class=footer-item data-pjax href=/categories target=_blank>分类列表</a><a class=footer-item data-pjax href=/tags target=_blank>标签列表</a><a class=footer-item data-pjax href=javascript:toRandomPost() target=_blank>随机文章</a></div></div><div class=footer-group><h3 class=footer-title>作品</h3><div class=footer-links><a class=footer-item data-pjax href=/articles/misc/lorem-ipsum target=_blank>Lorem Ipsum</a></div></div><div class=footer-group><h3 class=footer-title>协议</h3><div class=footer-links><a class=footer-item data-pjax href=/privacy target=_blank>隐私协议</a><a class=footer-item data-pjax href=/cookies target=_blank>Cookies</a><a class=footer-item data-pjax href=/copyright target=_blank>版权协议</a></div></div><div class=footer-group><div class=footer-title-group><h3 class=footer-title>友链</h3><button class=random-friends-btn id=footer-random-friends-btn onclick=javascript:wjx.addFriendLinksInFooter(); title=换一批友情链接><i class=icon-arrow-rotate-right style=font-size:16px></i></button></div><div class=footer-links id=friend-links-in-footer></div></div></div><div id=footer-bar style=padding:1rem><div class=footer-bar-links><div class=footer-bar-left><div id=footer-bar-tips><div class=copyright-group>© <span class=inline-word id=copyright-info>2025</span>  By  <a class=footer-bar-link href=/ target=_blank> <picture class=progressive-picture id=copyright-logo><img class=progressive-thumbnail decoding=async loading=lazy src=/processed_images/avatar.d5facb578cf12fdc.webp><source media="(min-width: 1em)" srcset=/processed_images/avatar.8bb6bf05eac51207.avif><img class=progressive-content decoding=async loading=lazy onload=progressiveLoad(this) src=/processed_images/avatar.06a48b3b45482d6b.webp><noscript><img decoding=async loading=lazy src=/processed_images/avatar.06a48b3b45482d6b.webp></noscript></picture> ByeIO·开发者博客 </a><script defer>var startYear = 2025;
                            var currentYear = new Date().getFullYear();
                            var copyrightInfo = `${startYear !== currentYear ? startYear + ' - ' : ''}${currentYear}`;
                            document.getElementById('copyright-info').innerHTML = copyrightInfo;</script></div><div class=compliance-group><a rel="noopener external nofollow noreferrer" class=footer-bar-link href=https://beian.miit.gov.cn/#/Integrated/index target=_blank> ICP </a><a class=footer-bar-link href=https://github.com/iWangJiaxiang/zola-theme-jiaxiang.wang> <div class=status-light></div> <span>本站及主题基于 Zola 构建</span> </a></div></div></div><div class=footer-bar-right><a class=footer-bar-link href=/subscribe target=_blank>订阅</a><a class=footer-bar-link href=https://github.com/iWangJiaxiang/zola-theme-jiaxiang.wang target=_blank>主题</a><a class=footer-bar-link href=/about>关于</a><a class=footer-bar-link href=mailto:mail@example.com target=_blank>反馈</a><a class="footer-bar-link cc" href=/copyright rel=license target=_blank title=CC版权协议> <i class=icon-copyright-line></i> <i class=icon-creative-commons-by-line></i> <i class=icon-creative-commons-nc-line></i> <i class=icon-creative-commons-nd-line></i> </a></div></div></div><div id=quit-box onclick=RemoveRewardMask()></div><div class="comment-barrage needEndHide" style=display:none></div><style>a.footer-bar-link.cloud{align-items:center;display:flex}img.entered.loading.cloud{height:32px}</style></footer></div><div id=sidebar><div id=menu-mask></div><div id=sidebar-menus><span class=sidebar-menu-item-title>功能</span><div class=sidebar-menu-item><button class="darkmode_switchbutton menu-child" href=javascript:void(0); onclick=rm.switchDarkMode() title=显示模式切换><i class=icon-moon style=font-size:.9rem;line-height:2></i> <span>显示模式</span></button></div><div class=back-menu-list-groups><div class=back-menu-list-group><div class=back-menu-list-title>作品</div><div class=back-menu-list><a class="back-menu-item nav-item" href=/articles/misc/lorem-ipsum>  <i class=icon-music style=font-size:.9em></i> <span class=back-menu-item-text>Lorem Ipsum</span> </a><a class="back-menu-item nav-item" href=/articles/misc/lorem-ipsum>  <i class=icon-music style=font-size:.9em></i> <span class=back-menu-item-text>Lorem Ipsum</span> </a></div></div></div><div class=menus_items><div class=menus_item><button class=site-page><span>文库</span></button><ul class=menus_item_child><li><a class="site-page child faa-parent animated-hover" draggable=false href=/archives> <i class="icon-book-open faa-tada" style=font-size:.9em></i> <span>全部文章</span> </a><li><a class="site-page child faa-parent animated-hover" draggable=false href=/categories> <i class="icon-folder-open faa-tada" style=font-size:.9em></i> <span>分类列表</span> </a><li><a class="site-page child faa-parent animated-hover" draggable=false href=/tags> <i class="icon-tags faa-tada" style=font-size:.9em></i> <span>标签列表</span> </a><li><a class="site-page child faa-parent animated-hover" draggable=false href=javascript:toRandomPost()> <i class="icon-artstation faa-tada" style=font-size:.9em></i> <span>随机文章</span> </a></ul></div><div class=menus_item><a class=site-page href=/tags/work> <span>推荐</span> </a><ul class=menus_item_child><li><a class="site-page child faa-parent animated-hover" draggable=false href=/articles/docs/readme> <i class="icon-music faa-tada" style=font-size:.9em></i> <span>博客主题介绍</span> </a><li><a class="site-page child faa-parent animated-hover" draggable=false href=/articles/misc/lorem-ipsum> <i class="icon-music faa-tada" style=font-size:.9em></i> <span>Lorem Ipsum</span> </a></ul></div><div class=menus_item><button class=site-page><span>友链</span></button><ul class=menus_item_child><li><a class="site-page child faa-parent animated-hover" draggable=false href=/friends> <i class="icon-link faa-tada" style=font-size:.9em></i> <span>友链列表</span> </a><li><a class="site-page child faa-parent animated-hover" draggable=false href=javascript:travelling()> <i class="icon-paper-plane faa-tada" style=font-size:.9em></i> <span>随机发现</span> </a></ul></div><div class=menus_item><button class=site-page><span>我的</span></button><ul class=menus_item_child><li><a class="site-page child faa-parent animated-hover" draggable=false href=/about> <i class="icon-rocket faa-tada" style=font-size:.9em></i> <span>关于本人</span> </a><li><a class="site-page child faa-parent animated-hover" draggable=false href=/equipment> <i class="icon-artstation faa-tada" style=font-size:.9em></i> <span>我的装备</span> </a><li><a class="site-page child faa-parent animated-hover" draggable=false href=/tags/project> <i class="icon-lightbulb faa-tada" style=font-size:.9em></i> <span>我的项目</span> </a></ul></div></div><span class=sidebar-menu-item-title>标签</span><div class="card-widget card-tags card-archives card-webinfo card-allinfo"><div class=item-headline></div><div class=card-tag-cloud><a class=tag-item href=/tags/blog/ style=font-size:1em title=博客>  博客<sup>31</sup> </a><a class=tag-item href=/tags/docs/ style=font-size:1em title=文档>  文档<sup>25</sup> </a><a class=tag-item href=/tags/featured/ style=font-size:1em title=必看>  必看<sup>30</sup> </a><a class=tag-item href=/tags/hot/ style=font-size:1em title=热门>  热门<sup>30</sup> </a><a class=tag-item href=/tags/project/ style=font-size:1em title=项目>  项目<sup>1</sup> </a><a class=tag-item href=/tags/work/ style=font-size:1em title=work>  work<sup>1</sup> </a></div></div></div></div><div id=console><div class=close-btn href=javascript:void(0); onclick=wjx.hideConsole()><i class=icon-circle-xmark></i></div><div class=console-card-group><div class=console-card-group-left><div class=console-card id=card-newest-comments onclick=wjx.hideConsole()><div class=card-content><div class=author-content-item-tips>互动</div><span class=author-content-item-title>最近评论</span></div><div class=aside-list><span>正在加载中...</span></div></div></div><div class=console-card-group-right><div class="console-card tags" onclick=wjx.hideConsole()><div class=card-content><div class=author-content-item-tips>标签</div><span class=author-content-item-title>寻找感兴趣的领域</span></div><div class=card-tag-cloud><a href=/tags/blog/ rel=tag style=color:#d3d3d3;font-size:1em> 博客<sup>31</sup> </a><a href=/tags/docs/ rel=tag style=color:#d3d3d3;font-size:1em> 文档<sup>25</sup> </a><a href=/tags/featured/ rel=tag style=color:#d3d3d3;font-size:1em> 必看<sup>30</sup> </a><a href=/tags/hot/ rel=tag style=color:#d3d3d3;font-size:1em> 热门<sup>30</sup> </a><a href=/tags/project/ rel=tag style=color:#d3d3d3;font-size:1em> 项目<sup>1</sup> </a><a href=/tags/work/ rel=tag style=color:#d3d3d3;font-size:1em> work<sup>1</sup> </a></div></div><div class="console-card history" onclick=wjx.hideConsole()><div class=item-headline><i class="fas fa-archive"></i><span>文章</span></div><ul class=card-archive-list><ul><li class=card-archive-list-item><a class=card-archive-list-link href=/archives> <span class=card-archive-list-date> 2025 1月 </span> <div class=card-archive-list-count-group><span class=card-archive-list-count>25</span><span class=card-archive-list-count-unit>篇</span></div> </a></ul><ul><li class=card-archive-list-item><a class=card-archive-list-link href=/archives> <span class=card-archive-list-date> 2024 12月 </span> <div class=card-archive-list-count-group><span class=card-archive-list-count>6</span><span class=card-archive-list-count-unit>篇</span></div> </a></ul></ul></div></div></div><div class=button-group><div class=console-btn-item><button rel="external nofollow" class=darkmode_switchbutton href=javascript:void(0); onclick=navFn.switchDarkMode(); title=显示模式切换><i class=icon-moon-clear-fill style=font-size:1rem></i></button></div><div class=console-btn-item id=consoleHideAside onclick=wjx.hideAsideBtn() title=边栏显示控制><button class=asideSwitch title=侧边栏开关><i class=icon-arrows-left-right></i></button></div><div class="console-btn-item on" id=consoleCommentBarrage onclick=wjx.switchCommentBarrage() title=热评开关><button class=commentBarrage><i class=icon-chat--fill></i></button></div></div><div class=console-mask href=javascript:void(0); onclick=wjx.hideConsole()></div></div><div id=rightside><div id=rightside-config-hide><button id=translateLink title=简繁转换 type=button>繁</button><button id=darkmode title=浅色和深色模式转换 type=button><i class=icon-circle-half-stroke></i></button><button id=hide-aside-btn title=单栏和双栏切换 type=button><i class=icon-arrows-left-right></i></button></div><div id=rightside-config-show><button id=rightside-config title=设置 type=button><i class=icon-gear></i></button><a href=#post-comment id=to_comment title=直达评论><i class=icon-chat--fill style=font-size:17px></i></a><button id=go-up title=回到顶部 type=button><i class=icon-arrow-up></i></button></div></div><link onload="this.onload=null;this.rel='stylesheet'" as=style href=/css/read-mode.css rel=preload><noscript><link href=/css/read-mode.css rel=stylesheet></noscript><div class=js-pjax><div id=rightMenu><div class="rightMenu-group rightMenu-small"><div class=rightMenu-item id=menu-backward><i class=icon-arrow-left></i></div><div class=rightMenu-item id=menu-forward><i class=icon-arrow-right></i></div><div class=rightMenu-item id=menu-refresh><i class=icon-arrow-rotate-right></i></div><div class=rightMenu-item id=menu-top><i class=icon-arrow-up></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class=rightMenu-item id=menu-copytext><i class=icon-copy></i><span>复制选中文本</span></div><div class=rightMenu-item id=menu-pastetext><i class=icon-paste></i><span>粘贴文本</span></div><a class=rightMenu-item id=menu-commenttext> <i class=icon-comment-medical></i> <span>引用到评论</span> </a><div class=rightMenu-item id=menu-newwindow><i class=icon-window-restore></i><span>新窗口打开</span></div><div class=rightMenu-item id=menu-copylink><i class=icon-link></i><span>复制链接地址</span></div><div class=rightMenu-item id=menu-copyimg><i class=icon-images></i><span>复制此图片</span></div><div class=rightMenu-item id=menu-downloadimg><i class=icon-download></i><span>下载此图片</span></div><div class=rightMenu-item id=menu-newwindowimg><i class=icon-window-restore></i><span>新窗口打开图片</span></div><div class=rightMenu-item id=menu-search><i class=icon-search--line></i><span>站内搜索</span></div><div class=rightMenu-item id=menu-searchBaidu><i class=icon-baidu></i><span>百度搜索</span></div><div class=rightMenu-item id=menu-music-toggle><i class=icon-play></i><span>播放音乐</span></div><div class=rightMenu-item id=menu-music-back><i class=icon-backward></i><span>切换到上一首</span></div><div class=rightMenu-item id=menu-music-forward><i class=icon-forward></i><span>切换到下一首</span></div><div onclick="javascript:window.open('https://y.qq.com/n/ryqq/playlist/xxxxx')" class=rightMenu-item id=menu-music-playlist><i class=icon-radio></i><span>查看所有歌曲</span></div><div class=rightMenu-item id=menu-music-copyMusicName><i class=icon-copy></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id=menu-randomPost onclick=toRandomPost()> <i class=icon-shuffle></i> <span>随便逛逛</span> </a><a class="rightMenu-item menu-link" href=../categories> <i class=icon-cube></i> <span>博客分类</span> </a><a class="rightMenu-item menu-link" href=../tags> <i class=icon-tags></i> <span>文章标签</span> </a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><div class=rightMenu-item id=menu-copy><i class=icon-copy></i><span>复制地址</span></div><div class=rightMenu-item draggable=false id=menu-commentBarrage style=display:flex><i class=icon-chat--fill style=font-size:19px></i><span class=menu-commentBarrage-text>显示热评</span></div><div class=rightMenu-item id=menu-darkmode><i class=icon-moon-clear-fill style=font-size:19px></i><span class=menu-darkmode-text>深色模式</span></div><div class=rightMenu-item id=menu-translate><i class=icon-fanti style=font-size:19px></i><span>轉為繁體</span></div></div></div><div id=rightmenu-mask></div></div><script defer onload src=/libs/qrcode/qrcode.min.js></script><script defer src=/libs/view-image/view-image.min.js></script><script defer src=/libs/tocbot/4.18.2/tocbot.min.js></script><link onload="this.onload=null;this.rel='stylesheet'" as=style href=/libs/tocbot/4.18.2/tocbot.css rel=preload><noscript><link href=/libs/tocbot/4.18.2/tocbot.css rel=stylesheet></noscript><script async src=/libs/snackbar/snackbar.min.js></script><script>var meting_api = "https:&#x2F;&#x2F;api.i-meto.com&#x2F;meting&#x2F;api?server=:server&amp;type=:type&amp;id=:id&amp;r=:r";</script><canvas height=880 id=universe width=1312></canvas><script defer src=/libs/canvas/dark.js></script><script src=/libs/waterfall/waterfall.min.js></script><script src=/libs/fast-average-color/index.browser.min.js></script><script>let pjaxSelectors = ['title', '#body-wrap', '#rightside-config-hide', '#rightside-config-show', '.js-pjax', '#site-config']
          
    pjaxSelectors.unshift('meta[property="og:type"]', 'meta[property="og:image"]', 'meta[property="og:title"]', 'meta[property="og:url"]', 'meta[property="og:description"]'
            , 'meta[name="twitter:title"]', 'meta[name="twitter:url"]', 'meta[name="twitter:description"]', 'meta[name="twitter:image"]', 'meta[name="description"]')
    
    var pjax = new Pjax({
        elements: 'a:not([target="_blank"])',
        selectors: pjaxSelectors,
        cacheBust: false,
        //debug: true,        
        analytics: false,
        scrollRestoration: false
    })</script><script defer src=/js/rightmenu.js></script><script data-pjax defer src=/production/js/abstract/local.js></script><script data-pjax defer src=/production/js/bundle.js></script><script defer src=/js/tw_cn.js></script><script defer src=/libs/instantpage/instantpage.min.js type=module></script><link onload="this.rel='stylesheet'" as=style href=/libs/prism/prism.min.css rel=preload><noscript><link href=/libs/prism/prism.min.css rel=stylesheet></noscript><link onload="this.rel='stylesheet'" as=style href=/libs/prism/code.css rel=preload><noscript><link href=/libs/prism/code.css rel=stylesheet></noscript><link onload="this.rel='stylesheet'" as=style data-code-theme=light href=/libs/prism/themes/prism-one-dark.css rel=preload><noscript><link href=/libs/prism/themes/prism-one-dark.css rel=stylesheet></noscript><link onload="this.rel='stylesheet'" as=style data-code-theme=dark href=/libs/prism/themes/prism-one-dark.css rel=preload><noscript><link href=/libs/prism/themes/prism-one-dark.css rel=stylesheet></noscript><script defer src=/libs/prism/prism.min.js></script><style>#article-container .code-toolbar pre.close{height:300px;overflow:hidden}</style>